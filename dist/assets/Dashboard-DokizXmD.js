import{c as it,b as q,u as lt,d as rt,r as V,e as dt,f as G,g as H,h as ct,i as ut}from"./index-GcpNd-v9.js";import{c,E as u,l as t,r as M,J as O,o as mt,k as R,R as pt,W as gt,F as I,y as C,q as i,H as b,p as Y,z as m,e as X,b as B,A as xt,j}from"./vendor-Cn5j0SEu.js";import{_ as yt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as tt}from"./DocumentArrowDownIcon-CfkQcPq0.js";import{r as bt}from"./CheckCircleIcon-9dtlsCvY.js";import{f as et,l as st}from"./index-BoRhMNJp.js";import"./excel-C9Ruqv6W.js";function ht(P,s){return u(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.114 5.636a9 9 0 0 1 0 12.728M16.463 8.288a5.25 5.25 0 0 1 0 7.424M6.75 8.25l4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z"})])}const ft="https://xpvnhfafueuobpebciqg.supabase.co",_t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhwdm5oZmFmdWV1b2JwZWJjaXFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQyNDgwOTAsImV4cCI6MjA2OTgyNDA5MH0.wFcHRb4JzRBnpgJOfdYWYMDex_W5QWSYjmBYxwc5F94",vt=async()=>{var v;const P=it(ft,_t),s={connection:{status:"unknown",message:"",details:null},tables:{},permissions:{status:"unknown",message:""},summary:{tablesExist:0,totalTables:5,allTablesReady:!1}},x=["students","transactions","expenses","payment_links","campaigns"];try{console.log("Testing database connection...");for(const r of x)try{console.log(`Testing table: ${r}`);const{data:h,error:p}=await P.from(r).select("count").limit(1);p?(s.tables[r]={exists:!1,error:p.message,details:p},console.error(`Error with table ${r}:`,p)):(s.tables[r]={exists:!0,error:null,recordCount:h?h.length:0},s.summary.tablesExist++,console.log(`Table ${r}: OK`))}catch(h){s.tables[r]={exists:!1,error:h.message||h.toString(),details:h},console.error(`Exception testing table ${r}:`,h)}if(s.summary.tablesExist>0?(s.connection.status="connected",s.connection.message="Connected to Supabase"):(s.connection.status="no_tables",s.connection.message="Connected but no tables found"),s.summary.allTablesReady=s.summary.tablesExist===s.summary.totalTables,(v=s.tables.students)!=null&&v.exists)try{const r={name:"TEST_STUDENT_DELETE_ME",nickname:"TEST",phone:"+1234567890"},{data:h,error:p}=await P.from("students").insert(r).select();p?s.permissions={status:"limited",message:`Insert permission denied: ${p.message}`,details:p}:h&&h.length>0&&(await P.from("students").delete().eq("id",h[0].id),s.permissions={status:"full",message:"Full read/write permissions available"})}catch(r){s.permissions={status:"error",message:`Permission test failed: ${r.message}`,details:r}}}catch(r){s.connection={status:"failed",message:`Connection failed: ${r.message}`,details:r},console.error("Database connection failed:",r)}return s},wt=P=>{const{tables:s,summary:x,connection:v,permissions:r}=P;if(v.status==="failed")return{priority:"critical",title:"Database Connection Failed",message:"Cannot connect to Supabase database. Please check your configuration.",actions:["Verify VITE_SUPABASE_URL is correct","Verify VITE_SUPABASE_ANON_KEY is correct","Check Supabase project status","Ensure network connectivity"]};if(x.tablesExist===0)return{priority:"high",title:"Database Tables Missing",message:"Connected to Supabase but no required tables exist.",actions:["Go to Settings → Database Setup",'Click "Quick Setup (Auto)" or "Manual Setup"',"If manual setup: copy SQL and run in Supabase SQL Editor","Refresh page after setup"]};if(x.tablesExist<x.totalTables){const h=Object.entries(s).filter(([p,f])=>!f.exists).map(([p])=>p);return{priority:"medium",title:"Incomplete Database Setup",message:`${x.tablesExist}/${x.totalTables} tables exist. Missing: ${h.join(", ")}`,actions:["Complete database setup in Settings","Run missing table creation SQL","Check for SQL execution errors"]}}return r.status==="limited"?{priority:"medium",title:"Limited Database Permissions",message:"Tables exist but write permissions may be limited.",actions:["Check Row Level Security (RLS) policies","Verify anon key permissions","Update Supabase table permissions if needed"]}:{priority:"low",title:"Database Ready",message:"All tables exist and permissions are working.",actions:["Database is properly configured"]}},$t={class:"space-y-6"},St={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0"},kt={class:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2"},Dt=["value"],Tt={class:"card p-6 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200"},It={class:"flex items-center justify-between mb-4"},Ct={class:"text-lg font-semibold text-blue-900"},Pt={class:"flex items-center space-x-4"},Rt={class:"text-center"},Bt={class:"text-2xl font-bold text-green-600"},Et={class:"text-center"},Mt={class:"text-2xl font-bold text-red-600"},jt={class:"text-center"},Nt={class:"text-2xl font-bold text-blue-600"},Lt={class:"w-full bg-gray-200 rounded-full h-3 mb-4"},At={class:"grid grid-cols-1 sm:grid-cols-3 gap-4 text-sm"},Ft={class:"flex justify-between"},Jt={class:"font-semibold text-green-600"},Kt={class:"flex justify-between"},Ot={class:"font-semibold"},Yt={class:"flex justify-between"},Ut={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},Vt={class:"flex items-center justify-between mb-3"},zt={class:"font-semibold text-gray-900"},Wt={class:"flex items-center space-x-2"},Qt=["onClick"],Zt={class:"space-y-3"},Gt={class:"grid grid-cols-3 gap-2 text-center"},Ht={class:"bg-green-50 rounded-lg p-2"},Xt={class:"text-lg font-bold text-green-600"},qt={class:"bg-red-50 rounded-lg p-2"},te={class:"text-lg font-bold text-red-600"},ee={class:"bg-blue-50 rounded-lg p-2"},se={class:"text-lg font-bold text-blue-600"},ae={class:"w-full bg-gray-200 rounded-full h-2"},ne={class:"text-center"},oe={class:"text-sm font-semibold text-gray-900"},ie={class:"flex space-x-2"},le=["onClick"],re=["onClick"],de={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},ce={class:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden"},ue={class:"p-6 border-b border-gray-200"},me={class:"flex items-center justify-between"},pe={class:"text-lg font-semibold text-gray-900"},ge={class:"p-6 overflow-y-auto max-h-[70vh]"},xe={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ye={class:"font-semibold text-green-600 mb-3"},be={class:"space-y-2 max-h-64 overflow-y-auto"},he={class:"text-sm font-medium text-green-900"},fe={class:"text-right"},_e={class:"text-xs text-green-600"},ve={class:"text-xs text-green-500"},we={class:"font-semibold text-red-600 mb-3"},$e={class:"space-y-2 max-h-64 overflow-y-auto"},Se={class:"text-sm font-medium text-red-900"},ke=["onClick"],De={class:"mt-6"},Te={class:"overflow-x-auto"},Ie={class:"min-w-full divide-y divide-gray-200"},Ce={class:"bg-white divide-y divide-gray-200"},Pe={class:"px-4 py-2 text-sm text-gray-900"},Re={class:"px-4 py-2 text-sm text-gray-900"},Be={class:"px-4 py-2 text-sm text-gray-500"},Ee={class:"px-4 py-2 text-sm font-medium text-green-600 text-right"},Me={__name:"MonthlyPaymentTracker",setup(P){const s=q(),x=lt(),v=M(new Date().getFullYear()),r=M([]),h=M(!1),p=M(null),f=M(5e4*s.students.length),N=O(()=>{const o=new Date().getFullYear();return[o-1,o,o+1]}),U=O(()=>new Date().toLocaleDateString("id-ID",{month:"long"})),D=O(()=>{const o=new Date().toISOString().slice(0,7),a=r.value.find(n=>n.monthCode===o);return a?{paid:a.paidStudents.length,unpaid:a.unpaidStudents.length,rate:a.paymentRate,totalIncome:a.totalIncome}:{paid:0,unpaid:s.students.length,rate:0,totalIncome:0}}),y=o=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(o),e=o=>et(new Date(o),"dd MMM yyyy",{locale:st}),$=()=>{const o=[],a=v.value;for(let n=0;n<12;n++){const _=new Date(a,n,1),w=_.toISOString().slice(0,7),A=_.toLocaleDateString("id-ID",{month:"long"}),k=w===new Date().toISOString().slice(0,7),K=s.transactions.filter(g=>new Date(g.created_at).toISOString().slice(0,7)===w&&g.type==="income"&&g.status==="completed"),W=K.map(g=>g.student_id),E={};K.forEach(g=>{E[g.student_id]||(E[g.student_id]={amount:0,date:g.created_at}),E[g.student_id].amount+=g.amount,new Date(g.created_at)>new Date(E[g.student_id].date)&&(E[g.student_id].date=g.created_at)});const Q=s.students.filter(g=>W.includes(g.id)).map(g=>{var F,Z;return{...g,monthlyAmount:((F=E[g.id])==null?void 0:F.amount)||0,paidDate:(Z=E[g.id])==null?void 0:Z.date}}),at=s.students.filter(g=>!W.includes(g.id)),nt=K.reduce((g,F)=>g+F.amount,0),ot=s.students.length>0?Math.round(Q.length/s.students.length*100):0;o.push({monthCode:w,monthName:A,year:a,isCurrentMonth:k,paidStudents:Q,unpaidStudents:at,transactions:K,totalIncome:nt,paymentRate:ot})}r.value=o.reverse()},l=o=>o.paymentRate===100?"Lengkap":o.paymentRate>=80?"Baik":o.paymentRate>=50?"Sedang":o.paymentRate>0?"Kurang":"Kosong",S=o=>o.paymentRate===100?"bg-green-100 text-green-800":o.paymentRate>=80?"bg-blue-100 text-blue-800":o.paymentRate>=50?"bg-yellow-100 text-yellow-800":o.paymentRate>0?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800",z=o=>{p.value=o,h.value=!0},J=async(o,a)=>{var n;try{const w=`Kas Kelas ${a.monthName} ${a.year}`;if(await s.addTransaction({type:"income",amount:5e4,description:w,student_id:o.id,payment_method:"manual",status:"completed",month:a.monthCode,created_at:new Date().toISOString(),notes:`Pembayaran manual untuk ${a.monthName} ${a.year}`}),x.success(`✅ ${o.name} berhasil ditandai LUNAS untuk ${a.monthName}!`),$(),((n=p.value)==null?void 0:n.monthCode)===a.monthCode){const A=r.value.find(k=>k.monthCode===a.monthCode);p.value=A}}catch(_){console.error("Error marking student as paid:",_),x.error("Gagal menandai siswa sebagai lunas")}},d=async o=>{if(o.unpaidStudents.length===0){x.info("Semua siswa sudah bayar untuk bulan ini");return}if(confirm(`Tandai SEMUA ${o.unpaidStudents.length} siswa sebagai LUNAS untuk ${o.monthName} ${o.year}?

Total akan menambah: ${y(o.unpaidStudents.length*5e4)}`))try{const n=o.unpaidStudents.map(_=>s.addTransaction({type:"income",amount:5e4,description:`Kas Kelas ${o.monthName} ${o.year} (Bulk)`,student_id:_.id,payment_method:"manual_bulk",status:"completed",month:o.monthCode,created_at:new Date().toISOString(),notes:`Pembayaran bulk untuk ${o.monthName} ${o.year}`}));await Promise.all(n),x.success(`✅ Semua ${o.unpaidStudents.length} siswa berhasil ditandai LUNAS untuk ${o.monthName}!`),$()}catch(n){console.error("Error marking all students as paid:",n),x.error("Gagal menandai semua siswa sebagai lunas")}},T=async o=>{if(o.unpaidStudents.length===0){x.info("Semua siswa sudah bayar untuk bulan ini");return}try{const a=`Kas Kelas ${o.monthName} ${o.year}`,_=(await s.generateBulkPaymentLinks(5e4,a,!1)).filter(w=>w.success).length;x.success(`✅ Berhasil generate ${_} link pembayaran untuk ${o.monthName}`)}catch(a){console.error("Error generating links:",a),x.error("Gagal generate link pembayaran")}},L=()=>{const o=["Bulan","Tahun","Sudah Bayar","Belum Bayar","Rate (%)","Total Pemasukan","Status"],a=r.value.map(k=>[k.monthName,k.year,k.paidStudents.length,k.unpaidStudents.length,k.paymentRate,k.totalIncome,l(k)]),n=[o.join(","),...a.map(k=>k.join(","))].join(`
`),_=new Blob([n],{type:"text/csv;charset=utf-8;"}),w=document.createElement("a"),A=URL.createObjectURL(_);w.setAttribute("href",A),w.setAttribute("download",`laporan_bulanan_${v.value}.csv`),w.style.visibility="hidden",document.body.appendChild(w),w.click(),document.body.removeChild(w),x.success("Laporan bulanan berhasil di-export!")};return mt(()=>{$()}),(o,a)=>(u(),c("div",$t,[t("div",St,[a[3]||(a[3]=t("div",null,[t("h3",{class:"text-lg font-semibold text-gray-900"},"📅 Tracking Pembayaran Bulanan"),t("p",{class:"text-sm text-gray-500 mt-1"},"Kelola pembayaran kas kelas per bulan dengan mudah")],-1)),t("div",kt,[pt(t("select",{"onUpdate:modelValue":a[0]||(a[0]=n=>v.value=n),onChange:$,class:"input-field w-full sm:w-auto"},[(u(!0),c(I,null,C(N.value,n=>(u(),c("option",{key:n,value:n},i(n),9,Dt))),128))],544),[[gt,v.value]]),t("button",{onClick:L,class:"btn-secondary w-full sm:w-auto"},[b(m(tt),{class:"w-4 h-4 mr-2"}),a[2]||(a[2]=Y(" Export Bulanan ",-1))])])]),t("div",Tt,[t("div",It,[t("h4",Ct," 📊 "+i(U.value)+" "+i(v.value),1),t("div",Pt,[t("div",Rt,[t("div",Bt,i(D.value.paid),1),a[4]||(a[4]=t("div",{class:"text-xs text-gray-600"},"Sudah Bayar",-1))]),t("div",Et,[t("div",Mt,i(D.value.unpaid),1),a[5]||(a[5]=t("div",{class:"text-xs text-gray-600"},"Belum Bayar",-1))]),t("div",jt,[t("div",Nt,i(D.value.rate)+"%",1),a[6]||(a[6]=t("div",{class:"text-xs text-gray-600"},"Rate Bayar",-1))])])]),t("div",Lt,[t("div",{class:"bg-gradient-to-r from-green-500 to-emerald-500 h-3 rounded-full transition-all duration-500",style:X({width:D.value.rate+"%"})},null,4)]),t("div",At,[t("div",Ft,[a[7]||(a[7]=t("span",{class:"text-gray-600"},"Total Pemasukan:",-1)),t("span",Jt,i(y(D.value.totalIncome)),1)]),t("div",Kt,[a[8]||(a[8]=t("span",{class:"text-gray-600"},"Target Bulan Ini:",-1)),t("span",Ot,i(y(f.value)),1)]),t("div",Yt,[a[9]||(a[9]=t("span",{class:"text-gray-600"},"Pencapaian:",-1)),t("span",{class:B(["font-semibold",D.value.totalIncome>=f.value?"text-green-600":"text-orange-600"])},i(Math.round(D.value.totalIncome/f.value*100))+"% ",3)])])]),t("div",Ut,[(u(!0),c(I,null,C(r.value,n=>(u(),c("div",{key:n.monthCode,class:B(["card p-4 hover:shadow-lg transition-shadow duration-200",n.isCurrentMonth?"ring-2 ring-blue-500 bg-blue-50":""])},[t("div",Vt,[t("h5",zt,i(n.monthName)+" "+i(n.year),1),t("div",Wt,[t("span",{class:B(["px-2 py-1 text-xs rounded-full",S(n)])},i(l(n)),3),n.unpaidStudents.length>0?(u(),c("button",{key:0,onClick:_=>d(n),class:"text-green-600 hover:text-green-800 p-1",title:"Tandai semua lunas"},[b(m(bt),{class:"w-4 h-4"})],8,Qt)):R("",!0)])]),t("div",Zt,[t("div",Gt,[t("div",Ht,[t("div",Xt,i(n.paidStudents.length),1),a[10]||(a[10]=t("div",{class:"text-xs text-green-700"},"Lunas",-1))]),t("div",qt,[t("div",te,i(n.unpaidStudents.length),1),a[11]||(a[11]=t("div",{class:"text-xs text-red-700"},"Belum",-1))]),t("div",ee,[t("div",se,i(n.paymentRate)+"%",1),a[12]||(a[12]=t("div",{class:"text-xs text-blue-700"},"Rate",-1))])]),t("div",ae,[t("div",{class:B(["h-2 rounded-full transition-all duration-300",n.paymentRate>=80?"bg-green-500":n.paymentRate>=50?"bg-yellow-500":"bg-red-500"]),style:X({width:n.paymentRate+"%"})},null,6)]),t("div",ne,[t("div",oe,i(y(n.totalIncome)),1),a[13]||(a[13]=t("div",{class:"text-xs text-gray-500"},"Total Pemasukan",-1))]),t("div",ie,[t("button",{onClick:_=>z(n),class:"btn-outline text-xs py-1 px-2 flex-1"}," Detail ",8,le),n.unpaidStudents.length>0?(u(),c("button",{key:0,onClick:_=>T(n),class:"btn-secondary text-xs py-1 px-2 flex-1"}," Generate ",8,re)):R("",!0)])])],2))),128))]),h.value&&p.value?(u(),c("div",de,[t("div",ce,[t("div",ue,[t("div",me,[t("h3",pe," Detail "+i(p.value.monthName)+" "+i(p.value.year),1),t("button",{onClick:a[1]||(a[1]=n=>h.value=!1),class:"text-gray-400 hover:text-gray-600"},[b(m(rt),{class:"w-6 h-6"})])])]),t("div",ge,[t("div",xe,[t("div",null,[t("h4",ye," ✅ Sudah Bayar ("+i(p.value.paidStudents.length)+") ",1),t("div",be,[(u(!0),c(I,null,C(p.value.paidStudents,n=>(u(),c("div",{key:n.id,class:"flex items-center justify-between p-3 bg-green-50 rounded-lg"},[t("span",he,i(n.name),1),t("div",fe,[t("div",_e,i(y(n.monthlyAmount)),1),t("div",ve,i(e(n.paidDate)),1)])]))),128))])]),t("div",null,[t("h4",we," ❌ Belum Bayar ("+i(p.value.unpaidStudents.length)+") ",1),t("div",$e,[(u(!0),c(I,null,C(p.value.unpaidStudents,n=>(u(),c("div",{key:n.id,class:"flex items-center justify-between p-3 bg-red-50 rounded-lg"},[t("span",Se,i(n.name),1),t("button",{onClick:_=>J(n,p.value),class:"btn-success text-xs py-1 px-2"}," Tandai Lunas ",8,ke)]))),128))])])]),t("div",De,[a[15]||(a[15]=t("h4",{class:"font-semibold text-gray-900 mb-3"},"📋 Transaksi Bulan Ini",-1)),t("div",Te,[t("table",Ie,[a[14]||(a[14]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Tanggal"),t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Siswa"),t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Keterangan"),t("th",{class:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase"},"Jumlah")])],-1)),t("tbody",Ce,[(u(!0),c(I,null,C(p.value.transactions,n=>{var _;return u(),c("tr",{key:n.id},[t("td",Pe,i(e(n.created_at)),1),t("td",Re,i(((_=n.student)==null?void 0:_.name)||"-"),1),t("td",Be,i(n.description),1),t("td",Ee,i(y(n.amount)),1)])}),128))])])])])])])])):R("",!0)]))}},je=yt(Me,[["__scopeId","data-v-76997825"]]),Ne={class:"space-y-6"},Le={key:0,class:"space-y-4"},Ae={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},Fe={class:"flex"},Je={class:"flex-shrink-0"},Ke={class:"ml-3"},Oe={class:"mt-2 text-sm text-blue-700"},Ye={class:"mt-3 flex flex-wrap gap-2"},Ue={key:0,class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},Ve={class:"flex"},ze={class:"flex-shrink-0"},We={class:"ml-3"},Qe={class:"text-sm font-medium text-yellow-800"},Ze={class:"mt-2 text-sm text-yellow-700"},Ge={class:"mt-2 list-disc list-inside space-y-1"},He={key:1,class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},Xe={class:"flex"},qe={class:"flex-shrink-0"},ts={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between"},es={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"},ss={class:"card p-6"},as={class:"flex items-center"},ns={class:"p-2 bg-success-100 rounded-lg"},os={class:"ml-4"},is={class:"text-2xl font-semibold text-gray-900"},ls={class:"card p-6"},rs={class:"flex items-center"},ds={class:"p-2 bg-red-100 rounded-lg"},cs={class:"ml-4"},us={class:"text-2xl font-semibold text-gray-900"},ms={class:"card p-6"},ps={class:"flex items-center"},gs={class:"p-2 bg-primary-100 rounded-lg"},xs={class:"ml-4"},ys={class:"text-2xl font-semibold text-gray-900"},bs={class:"card p-6"},hs={class:"flex items-center"},fs={class:"p-2 bg-warning-100 rounded-lg"},_s={class:"ml-4"},vs={class:"text-2xl font-semibold text-gray-900"},ws={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},$s={class:"card p-6"},Ss={class:"space-y-4"},ks={class:"flex items-center justify-between p-3 bg-success-50 rounded-lg"},Ds={class:"text-sm font-semibold text-success-700"},Ts={class:"flex items-center justify-between p-3 bg-red-50 rounded-lg"},Is={class:"text-sm font-semibold text-red-700"},Cs={class:"card p-6"},Ps={class:"space-y-3"},Rs={class:"text-sm font-medium text-gray-900"},Bs={class:"text-xs text-gray-500"},Es={key:0,class:"text-center py-4"},Ms={class:"card p-4 sm:p-6"},js={class:"flex items-center justify-between mb-4"},Ns={class:"block sm:hidden space-y-3"},Ls={class:"flex items-center justify-between mb-2"},As={class:"font-medium text-sm"},Fs={class:"space-y-1 text-sm"},Js={class:"flex justify-between"},Ks={class:"text-right"},Os={class:"flex justify-between"},Ys={class:"flex justify-between"},Us={class:"text-xs"},Vs={class:"hidden sm:block overflow-x-auto"},zs={class:"min-w-full divide-y divide-gray-200"},Ws={class:"bg-white divide-y divide-gray-200"},Qs={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Zs={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Gs={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Hs={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},Xs={class:"px-6 py-4 whitespace-nowrap"},qs={key:0,class:"text-center py-8"},ta={class:"card p-4 sm:p-6"},ea={class:"grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4"},da={__name:"Dashboard",setup(P){const s=q(),x=!"https://xpvnhfafueuobpebciqg.supabase.co".includes("your-project")&&!"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhwdm5oZmFmdWV1b2JwZWJjaXFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQyNDgwOTAsImV4cCI6MjA2OTgyNDA5MH0.wFcHRb4JzRBnpgJOfdYWYMDex_W5QWSYjmBYxwc5F94".includes("your-anon-key"),v=M(null),r=M(null),h=O(()=>x&&s.students.length===0&&s.transactions.length===0&&s.expenses.length===0),p=async()=>{if(x&&h.value)try{console.log("Running database diagnostics..."),v.value=await vt(),r.value=wt(v.value),console.log("Diagnostics results:",v.value),console.log("Setup recommendation:",r.value)}catch(y){console.error("Error running diagnostics:",y)}},f=y=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(y),N=y=>et(new Date(y),"dd MMM yyyy",{locale:st}),U=async()=>{try{const y=D(),e=window.open("","_blank");e&&(e.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
          <title>Dashboard Report - ${new Date().toLocaleDateString("id-ID")}</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            h1 { color: #1f2937; border-bottom: 2px solid #3b82f6; padding-bottom: 10px; }
            h2 { color: #374151; margin-top: 20px; }
            .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 20px 0; }
            .stat-card { border: 1px solid #d1d5db; padding: 15px; border-radius: 8px; }
            .stat-value { font-size: 24px; font-weight: bold; color: #1f2937; }
            .stat-label { color: #6b7280; font-size: 14px; margin-bottom: 5px; }
            table { width: 100%; border-collapse: collapse; margin: 20px 0; }
            th, td { border: 1px solid #d1d5db; padding: 8px; text-align: left; }
            th { background-color: #f3f4f6; font-weight: bold; }
            .income { color: #059669; }
            .expense { color: #dc2626; }
            .footer { margin-top: 30px; text-align: center; color: #6b7280; font-size: 12px; }
          </style>
        </head>
        <body>
          ${y}
          <div class="footer">
            Generated on ${new Date().toLocaleString("id-ID")} | Dashboard Kas Kelas
          </div>
        </body>
        </html>
      `),e.document.close(),setTimeout(()=>{e.print()},500)),console.log("✅ Dashboard PDF Report generated successfully")}catch(y){console.error("Error generating Dashboard PDF:",y),alert("Gagal membuat PDF report dashboard")}},D=()=>{const y=s.transactions||[],e=s.students||[],$=y.filter(d=>d.type==="income"&&d.status==="completed").map(d=>d.student_id),l=e.map(d=>({...d,hasPaid:$.includes(d.id),paymentCount:y.filter(T=>T.student_id===d.id&&T.type==="income"&&T.status==="completed").length}));let S="";y.slice(0,15).forEach(d=>{var o;const T=d.type==="income"?"income":"expense",L=d.type==="income"?"+":"-";S+=`
      <tr>
        <td>${((o=d.student)==null?void 0:o.name)||"-"}</td>
        <td>${d.description}</td>
        <td class="${T}">${L}${f(d.amount)}</td>
        <td>${d.status==="completed"?"Selesai":"Pending"}</td>
        <td>${N(d.created_at)}</td>
      </tr>
    `});let J="";return l.forEach(d=>{const T=d.hasPaid?"income":"expense",L=d.hasPaid?"✅ Sudah Bayar":"❌ Belum Bayar";J+=`
      <tr>
        <td>${d.name}</td>
        <td>${d.nickname}</td>
        <td>${d.phone||"-"}</td>
        <td>${d.paymentCount}</td>
        <td class="${T}">${L}</td>
      </tr>
    `}),`
    <h1>📊 Dashboard Report Kas Kelas</h1>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-label">💰 Total Pemasukan</div>
        <div class="stat-value income">${f(s.totalIncome)}</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">📄 Total Pengeluaran</div>
        <div class="stat-value expense">${f(s.totalExpenses)}</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">💳 Saldo Kas</div>
        <div class="stat-value">${f(s.totalIncome-s.totalExpenses)}</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">👥 Total Siswa</div>
        <div class="stat-value">${s.students.length}</div>
      </div>
    </div>

    <h2>👥 Status Pembayaran Semua Siswa (${e.length} Siswa)</h2>
    <table>
      <thead>
        <tr>
          <th>Nama Siswa</th>
          <th>Nickname</th>
          <th>No. HP</th>
          <th>Total Bayar</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        ${J||'<tr><td colspan="5" style="text-align: center; color: #6b7280;">Tidak ada data siswa</td></tr>'}
      </tbody>
    </table>

    <h2>📋 Transaksi Terbaru (15 Terakhir)</h2>
    <table>
      <thead>
        <tr>
          <th>Siswa</th>
          <th>Keterangan</th>
          <th>Jumlah</th>
          <th>Status</th>
          <th>Tanggal</th>
        </tr>
      </thead>
      <tbody>
        ${S||'<tr><td colspan="5" style="text-align: center; color: #6b7280;">Tidak ada transaksi</td></tr>'}
      </tbody>
    </table>

    <h2>📈 Ringkasan Lengkap</h2>
    <p><strong>Total Siswa:</strong> ${e.length}</p>
    <p><strong>Siswa Sudah Bayar:</strong> ${l.filter(d=>d.hasPaid).length}</p>
    <p><strong>Siswa Belum Bayar:</strong> ${l.filter(d=>!d.hasPaid).length}</p>
    <p><strong>Total Pemasukan:</strong> ${f(s.totalIncome)}</p>
    <p><strong>Total Pengeluaran:</strong> ${f(s.totalExpenses)}</p>
    <p><strong>Saldo Kas:</strong> ${f(s.totalIncome-s.totalExpenses)}</p>
    <p><strong>Total Transaksi:</strong> ${y.length}</p>
  `};return(y,e)=>{const $=xt("router-link");return u(),c("div",Ne,[m(x)&&h.value?(u(),c("div",Le,[t("div",Ae,[t("div",Fe,[t("div",Je,[b(m(V),{class:"h-5 w-5 text-blue-400"})]),t("div",Ke,[e[2]||(e[2]=t("h3",{class:"text-sm font-medium text-blue-800"},"Database Setup Required",-1)),t("div",Oe,[e[1]||(e[1]=t("p",null,"Your Supabase database is connected but tables need to be created.",-1)),t("div",Ye,[b($,{to:"/settings",class:"btn-primary text-xs py-1 px-3"},{default:j(()=>e[0]||(e[0]=[Y(" Go to Settings ",-1)])),_:1,__:[0]}),t("button",{onClick:p,class:"btn-secondary text-xs py-1 px-3"}," Run Diagnostics ")])])])])]),r.value?(u(),c("div",Ue,[t("div",Ve,[t("div",ze,[b(m(V),{class:"h-5 w-5 text-yellow-400"})]),t("div",We,[t("h3",Qe,i(r.value.title),1),t("div",Ze,[t("p",null,i(r.value.message),1),t("ul",Ge,[(u(!0),c(I,null,C(r.value.actions,l=>(u(),c("li",{key:l},i(l),1))),128))])])])])])):R("",!0)])):R("",!0),m(x)?R("",!0):(u(),c("div",He,[t("div",Xe,[t("div",qe,[b(m(V),{class:"h-5 w-5 text-yellow-400"})]),e[3]||(e[3]=t("div",{class:"ml-3"},[t("h3",{class:"text-sm font-medium text-yellow-800"},"Mode Pengembangan"),t("div",{class:"mt-2 text-sm text-yellow-700"},[t("p",null,"Aplikasi berjalan dengan data simulasi. Untuk menggunakan database real, konfigurasikan Supabase di Settings.")])],-1))])])),t("div",ts,[e[5]||(e[5]=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-900"},"Dashboard Kas Kelas"),t("p",{class:"mt-1 text-sm text-gray-500"}," Overview keuangan dan statistik pembayaran ")],-1)),t("button",{onClick:U,class:"btn-primary mt-4 sm:mt-0 flex items-center",title:"Download Dashboard Report"},[b(m(tt),{class:"w-4 h-4 mr-2"}),e[4]||(e[4]=Y(" Download PDF Report ",-1))])]),t("div",es,[t("div",ss,[t("div",as,[t("div",ns,[b(m(dt),{class:"w-6 h-6 text-success-600"})]),t("div",os,[e[6]||(e[6]=t("p",{class:"text-sm font-medium text-gray-600"},"Total Pemasukan",-1)),t("p",is,i(f(m(s).totalIncome)),1)])])]),t("div",ls,[t("div",rs,[t("div",ds,[b(m(G),{class:"w-6 h-6 text-red-600"})]),t("div",cs,[e[7]||(e[7]=t("p",{class:"text-sm font-medium text-gray-600"},"Total Pengeluaran",-1)),t("p",us,i(f(m(s).totalExpenses)),1)])])]),t("div",ms,[t("div",ps,[t("div",gs,[b(m(H),{class:"w-6 h-6 text-primary-600"})]),t("div",xs,[e[8]||(e[8]=t("p",{class:"text-sm font-medium text-gray-600"},"Saldo Saat Ini",-1)),t("p",ys,i(f(m(s).currentBalance)),1)])])]),t("div",bs,[t("div",hs,[t("div",fs,[b(m(ct),{class:"w-6 h-6 text-warning-600"})]),t("div",_s,[e[9]||(e[9]=t("p",{class:"text-sm font-medium text-gray-600"},"Total Siswa",-1)),t("p",vs,i(m(s).students.length),1)])])])]),t("div",ws,[t("div",$s,[e[12]||(e[12]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Status Pembayaran Siswa",-1)),t("div",Ss,[t("div",ks,[e[10]||(e[10]=t("div",{class:"flex items-center"},[t("div",{class:"w-3 h-3 bg-success-500 rounded-full"}),t("span",{class:"ml-3 text-sm font-medium text-success-900"},"Sudah Bayar")],-1)),t("span",Ds,i(m(s).studentsByPaymentStatus.paid.length)+" siswa ",1)]),t("div",Ts,[e[11]||(e[11]=t("div",{class:"flex items-center"},[t("div",{class:"w-3 h-3 bg-red-500 rounded-full"}),t("span",{class:"ml-3 text-sm font-medium text-red-900"},"Belum Bayar")],-1)),t("span",Is,i(m(s).studentsByPaymentStatus.unpaid.length)+" siswa ",1)])])]),t("div",Cs,[e[15]||(e[15]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Link Pembayaran Pending",-1)),t("div",Ps,[(u(!0),c(I,null,C(m(s).pendingPayments.slice(0,5),l=>{var S;return u(),c("div",{key:l.id,class:"flex items-center justify-between p-3 bg-gray-50 rounded-lg"},[t("div",null,[t("p",Rs,i((S=l.student)==null?void 0:S.name),1),t("p",Bs,i(f(l.amount)),1)]),e[13]||(e[13]=t("span",{class:"text-xs bg-warning-100 text-warning-800 px-2 py-1 rounded-full"}," Pending ",-1))])}),128)),m(s).pendingPayments.length===0?(u(),c("div",Es,e[14]||(e[14]=[t("p",{class:"text-sm text-gray-500"},"Tidak ada pembayaran pending",-1)]))):R("",!0)])])]),t("div",Ms,[t("div",js,[e[17]||(e[17]=t("h3",{class:"text-lg font-semibold text-gray-900"},"Transaksi Terbaru",-1)),b($,{to:"/transactions",class:"text-sm text-primary-600 hover:text-primary-500"},{default:j(()=>e[16]||(e[16]=[Y(" Lihat Semua ",-1)])),_:1,__:[16]})]),t("div",Ns,[(u(!0),c(I,null,C(m(s).recentTransactions,l=>{var S;return u(),c("div",{key:l.id,class:"bg-gray-50 rounded-lg p-3"},[t("div",Ls,[t("div",As,i(((S=l.student)==null?void 0:S.name)||"-"),1),t("span",{class:B(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",l.status==="completed"?"bg-success-100 text-success-800":"bg-warning-100 text-warning-800"])},i(l.status==="completed"?"Selesai":"Pending"),3)]),t("div",Fs,[t("div",Js,[e[18]||(e[18]=t("span",{class:"text-gray-600"},"Keterangan:",-1)),t("span",Ks,i(l.description),1)]),t("div",Os,[e[19]||(e[19]=t("span",{class:"text-gray-600"},"Jumlah:",-1)),t("span",{class:B([l.type==="income"?"text-success-600":"text-red-600","font-medium"])},i(l.type==="income"?"+":"-")+i(f(l.amount)),3)]),t("div",Ys,[e[20]||(e[20]=t("span",{class:"text-gray-600"},"Tanggal:",-1)),t("span",Us,i(N(l.created_at)),1)])])])}),128))]),t("div",Vs,[t("table",zs,[e[21]||(e[21]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Tanggal "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Siswa "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Keterangan "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Jumlah "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Status ")])],-1)),t("tbody",Ws,[(u(!0),c(I,null,C(m(s).recentTransactions,l=>{var S;return u(),c("tr",{key:l.id},[t("td",Qs,i(N(l.created_at)),1),t("td",Zs,i(((S=l.student)==null?void 0:S.name)||"-"),1),t("td",Gs,i(l.description),1),t("td",Hs,[t("span",{class:B(l.type==="income"?"text-success-600":"text-red-600")},i(l.type==="income"?"+":"-")+i(f(l.amount)),3)]),t("td",Xs,[t("span",{class:B(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",l.status==="completed"?"bg-success-100 text-success-800":"bg-warning-100 text-warning-800"])},i(l.status==="completed"?"Selesai":"Pending"),3)])])}),128))])])]),m(s).recentTransactions.length===0?(u(),c("div",qs,e[22]||(e[22]=[t("p",{class:"text-sm text-gray-500"},"Belum ada transaksi",-1)]))):R("",!0)]),b(je),t("div",ta,[e[27]||(e[27]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Aksi Cepat",-1)),t("div",ea,[b($,{to:"/payments",class:"flex flex-col items-center p-3 sm:p-4 bg-primary-50 rounded-lg hover:bg-primary-100 transition-colors"},{default:j(()=>[b(m(H),{class:"w-6 h-6 sm:w-8 sm:h-8 text-primary-600 mb-2"}),e[23]||(e[23]=t("span",{class:"text-xs sm:text-sm font-medium text-primary-900 text-center"},"Buat Link Bayar",-1))]),_:1,__:[23]}),b($,{to:"/campaigns",class:"flex flex-col items-center p-3 sm:p-4 bg-success-50 rounded-lg hover:bg-success-100 transition-colors"},{default:j(()=>[b(m(ht),{class:"w-6 h-6 sm:w-8 sm:h-8 text-success-600 mb-2"}),e[24]||(e[24]=t("span",{class:"text-xs sm:text-sm font-medium text-success-900 text-center"},"Kirim Pesan",-1))]),_:1,__:[24]}),b($,{to:"/expenses",class:"flex flex-col items-center p-3 sm:p-4 bg-warning-50 rounded-lg hover:bg-warning-100 transition-colors"},{default:j(()=>[b(m(G),{class:"w-6 h-6 sm:w-8 sm:h-8 text-warning-600 mb-2"}),e[25]||(e[25]=t("span",{class:"text-xs sm:text-sm font-medium text-warning-900 text-center"},"Catat Pengeluaran",-1))]),_:1,__:[25]}),b($,{to:"/reports",class:"flex flex-col items-center p-3 sm:p-4 bg-purple-50 rounded-lg hover:bg-purple-100 transition-colors"},{default:j(()=>[b(m(ut),{class:"w-6 h-6 sm:w-8 sm:h-8 text-purple-600 mb-2"}),e[26]||(e[26]=t("span",{class:"text-xs sm:text-sm font-medium text-purple-900 text-center"},"Lihat Laporan",-1))]),_:1,__:[26]})])])])}}};export{da as default};

import{c as m,E as c,l as t,r as M,Q as vt,J as tt,o as Ut,k as C,H as g,p as E,z as p,F as L,y as I,q as i,R as P,W as K,e as wt,b as F,x as Lt,S as Q,X as $t,K as Et,A as Kt,j as Ot,V as At}from"./vendor-Cn5j0SEu.js";import{b as It,u as Bt,g as Rt,e as Gt,p as Nt}from"./index-GcpNd-v9.js";import{r as jt}from"./PlusIcon-Hols0ICP.js";import{r as Wt}from"./DocumentArrowDownIcon-CfkQcPq0.js";import{r as Mt}from"./EyeIcon-B8jtdIG5.js";import{r as Pt,a as it}from"./TrashIcon-8_Rw6v_G.js";import{r as Ct}from"./DocumentTextIcon-BLO7htXp.js";import{r as Ft}from"./ClockIcon-A7fuk63B.js";import{r as St}from"./CheckCircleIcon-9dtlsCvY.js";import{f as Vt,l as Jt}from"./index-BoRhMNJp.js";import"./excel-C9Ruqv6W.js";function Tt(V,k){return c(),m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})])}function z(V,k){return c(),m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 12.76c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.076-4.076a1.526 1.526 0 0 1 1.037-.443 48.282 48.282 0 0 0 5.68-.494c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z"})])}function ft(V,k){return c(),m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"})])}function kt(V,k){return c(),m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244"})])}const rt=()=>{const V=new Date,d=new Date(V.toLocaleString("en-US",{timeZone:"Asia/Jakarta"})).getHours();return d>=5&&d<11?"Selamat pagi":d>=11&&d<15?"Selamat siang":d>=15&&d<18?"Selamat sore":"Selamat malam"},dt=()=>new Date().toLocaleString("id-ID",{timeZone:"Asia/Jakarta",hour:"2-digit",minute:"2-digit"}),qt={class:"space-y-6"},zt={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0"},Ht={class:"card p-6"},Qt={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Yt=["onClick"],Zt={class:"text-center"},Xt={class:"text-2xl font-bold text-primary-600"},te={class:"text-sm font-medium text-gray-900 mt-1"},ee={class:"text-xs text-gray-500 mt-1"},se={class:"text-xs text-gray-600 mt-1"},ae={class:"card p-6"},ne={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},le={class:"border rounded-lg p-4 bg-green-50"},oe={class:"text-sm space-y-1"},ie={class:"flex justify-between"},re={class:"font-semibold"},de={class:"flex justify-between"},ue={class:"font-semibold"},me={class:"flex justify-between"},ce={class:"font-semibold"},pe={class:"card p-6"},ge={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 space-y-2 sm:space-y-0"},be={class:"flex space-x-2"},xe={class:"hidden sm:block overflow-x-auto"},ye={class:"min-w-full divide-y divide-gray-200"},he={class:"bg-white divide-y divide-gray-200"},ve={class:"px-6 py-4 whitespace-nowrap"},fe={class:"flex items-center"},ke={class:"w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center mr-3"},_e={class:"text-primary-600 font-semibold text-sm"},we={class:"text-sm font-medium text-gray-900"},$e={class:"text-sm text-gray-500"},Pe={class:"px-6 py-4 whitespace-nowrap"},Ce={class:"text-sm text-gray-900"},Se={class:"text-sm text-gray-500"},De={key:0,class:"text-xs text-blue-600 mt-1"},Ae={class:"px-6 py-4 whitespace-nowrap"},Me={class:"text-sm font-medium text-gray-900"},Te={class:"text-sm text-gray-500"},Le={class:"px-6 py-4 whitespace-nowrap"},Ie={class:"w-full bg-gray-200 rounded-full h-2 mb-1"},Be={class:"text-xs text-gray-500"},je={class:"px-6 py-4 whitespace-nowrap"},We={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},Ue={class:"flex items-center space-x-2"},Ee=["onClick"],Ke=["onClick"],Oe=["onClick"],Re=["onClick"],Ge=["onClick"],Ne={class:"block sm:hidden space-y-4"},Fe={class:"flex items-center justify-between mb-3"},Ve={class:"flex items-center"},Je={class:"w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center mr-3"},qe={class:"text-primary-600 font-semibold text-sm"},ze={class:"font-medium text-sm"},He={class:"text-gray-500 text-xs"},Qe={class:"space-y-2 text-sm"},Ye={class:"w-full bg-gray-200 rounded-full h-2"},Ze={class:"flex justify-between"},Xe={class:"flex justify-between"},ts={class:"font-medium"},es={class:"grid grid-cols-2 gap-2 mt-3 pt-3 border-t border-gray-200"},ss=["onClick"],as=["onClick"],ns=["onClick"],ls=["onClick"],os={class:"flex justify-center mt-2"},is=["onClick"],rs={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},ds={class:"bg-white rounded-lg max-w-lg w-full mx-4 p-6 max-h-[90vh] overflow-y-auto"},us={class:"text-lg font-semibold text-gray-900 mb-4"},ms=["value"],cs={class:"grid grid-cols-2 gap-4"},ps=["value"],gs=["value"],bs=["value"],xs={class:"border rounded-lg p-4 bg-blue-50"},ys={class:"space-y-3"},hs={class:"flex items-start space-x-3"},vs={class:"text-sm text-gray-600"},fs={class:"flex items-start space-x-3"},ks={class:"text-sm text-gray-600"},_s={class:"flex items-start space-x-3"},ws={class:"bg-gray-50 p-4 rounded-lg"},$s={class:"space-y-1 text-sm"},Ps={class:"flex justify-between"},Cs={class:"flex justify-between"},Ss={class:"flex justify-between font-bold border-t pt-1"},Ds={class:"mt-3 pt-3 border-t border-gray-300"},As={class:"space-y-1 text-xs"},Ms={key:0,class:"text-green-600"},Ts={key:1,class:"text-blue-600"},Ls={key:2,class:"text-purple-600 font-medium"},Is={class:"flex justify-end space-x-3 pt-4"},Bs=["disabled"],js={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},Ws={class:"bg-white rounded-lg max-w-2xl w-full mx-4 p-6 max-h-[90vh] overflow-y-auto"},Us={class:"space-y-6"},Es={class:"flex items-center space-x-4"},Ks={class:"w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center"},Os={class:"text-primary-600 font-semibold text-xl"},Rs={class:"text-lg font-medium text-gray-900"},Gs={class:"text-sm text-gray-500"},Ns={class:"flex justify-between mb-2"},Fs={class:"text-sm text-gray-500"},Vs={class:"w-full bg-gray-200 rounded-full h-3"},Js={class:"flex justify-between mt-2 text-sm text-gray-600"},qs={class:"flex items-center justify-between mb-3"},zs={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Hs={class:"flex items-center justify-between"},Qs={class:"text-sm font-medium"},Ys={class:"flex items-center space-x-2"},Zs={key:0,class:"text-green-600 text-xs"},Xs={key:1,class:"text-gray-500 text-xs"},ta=["onClick"],ea={class:"text-xs text-gray-600 mt-1"},sa={key:0,class:"text-xs text-green-600 mt-1"},aa={key:0,class:"space-y-3"},na={class:"flex items-center justify-between mb-2"},la={class:"flex items-center space-x-2"},oa={class:"font-medium text-sm"},ia={class:"flex space-x-1"},ra=["onClick"],da=["onClick"],ua={class:"text-xs text-gray-600 mb-2"},ma={class:"text-xs font-mono text-gray-500 bg-white px-2 py-1 rounded border"},ca={class:"mt-2 flex items-center space-x-2"},pa=["value"],ga={key:1,class:"border rounded-lg p-3 bg-gray-50"},ba={class:"flex items-center space-x-2"},xa=["value"],ya={class:"flex flex-col space-y-3 pt-6 border-t"},ha={class:"flex space-x-3"},va={key:0,class:"flex space-x-3"},fa={class:"flex space-x-3"},ka={__name:"MultiMonthPayment",setup(V){const k=It(),d=Bt(),J=M(!1),O=M(!1),y=M(null),B=M(!1),U=M(""),r=vt({studentId:"",startMonth:new Date().getMonth()+1,year:new Date().getFullYear(),months:6,monthlyAmount:5e4,linkType:"both"}),D=M([]),R=tt(()=>k.students),w=[{value:1,label:"Januari"},{value:2,label:"Februari"},{value:3,label:"Maret"},{value:4,label:"April"},{value:5,label:"Mei"},{value:6,label:"Juni"},{value:7,label:"Juli"},{value:8,label:"Agustus"},{value:9,label:"September"},{value:10,label:"Oktober"},{value:11,label:"November"},{value:12,label:"Desember"}],T=[2024,2025,2026],$=[{months:3,label:"3 Bulan",amount:15e4},{months:6,label:"6 Bulan",amount:3e5},{months:12,label:"1 Tahun",amount:6e5}],q=tt(()=>U.value?D.value.filter(o=>o.status===U.value):D.value),v=o=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(o),j=o=>({pending:"Belum Bayar",partial:"Sebagian",completed:"Lunas"})[o]||o,ut=o=>{const s={pending:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800",partial:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",completed:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800"};return s[o]||s.pending},Y=()=>{if(!r.startMonth||!r.months)return"";const o=r.startMonth-1,s=(o+r.months-1)%12;return`${w[o].label} - ${w[s].label} ${r.year}`},et=()=>r.monthlyAmount*r.months,Z=o=>{r.months=o.months,r.monthlyAmount=5e4,J.value=!0},A=o=>["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"][(o-1)%12],X=()=>{J.value=!1,y.value=null,Object.assign(r,{studentId:"",startMonth:new Date().getMonth()+1,year:new Date().getFullYear(),months:6,monthlyAmount:5e4,linkType:"both"})},st=async()=>{var o;B.value=!0;try{await new Promise(f=>setTimeout(f,1e3));const s=R.value.find(f=>f.id===r.studentId),b=et();if(y.value){const f=y.value,l=D.value.findIndex(e=>e.id===f.id);if(l!==-1){const e={...f,student:s,period_label:Y(),months:r.months,monthly_amount:r.monthlyAmount,total_amount:b,progress_percentage:Math.round(f.paid_amount/b*100),payment_url:`https://pakasir.zone.id/pay/uang-kas-kelas-1-ibnu-sina/${b}?order_id=${s.nickname.toUpperCase()}${f.id}`};D.value[l]=e,d.success(`âœ… Pembayaran ${s.name} berhasil diupdate!`)}}else{const f=`${s.nickname.toUpperCase()}${Date.now()}`,l=[];if(r.linkType==="individual"||r.linkType==="both")for(let n=1;n<=r.months;n++){const u=`${f}M${n.toString().padStart(2,"0")}`;l.push({id:`individual_${n}`,type:"individual",month:n,amount:r.monthlyAmount,order_id:u,url:`https://pakasir.zone.id/pay/uang-kas-kelas-1-ibnu-sina/${r.monthlyAmount}?order_id=${u}`,description:`Kas Bulan ke-${n} (${A(r.startMonth+n-1)})`})}if(r.linkType==="single"||r.linkType==="both"){const n=`${f}TOTAL`;l.push({id:"total",type:"total",amount:b,order_id:n,url:`https://pakasir.zone.id/pay/uang-kas-kelas-1-ibnu-sina/${b}?order_id=${n}`,description:`Kas ${r.months} Bulan Sekaligus`})}const e={id:Date.now().toString(),student:s,period_label:Y(),months:r.months,monthly_amount:r.monthlyAmount,total_amount:b,paid_amount:0,progress_percentage:0,status:"pending",payment_url:((o=l[0])==null?void 0:o.url)||"",payment_links:l,link_type:r.linkType,month_details:[]};D.value.unshift(e);const a=l.length,x=r.linkType==="both"?"individual + total":r.linkType;d.success(`âœ… Multi-Month Payment berhasil dibuat!
${a} link ${x} telah digenerate`)}X()}catch(s){console.error("Error saving payment:",s),d.error("Gagal menyimpan pembayaran multi-bulan")}finally{B.value=!1}},at=o=>{y.value=o,O.value=!0},nt=async o=>{var s;try{const b=o.student,f=o.total_amount-o.paid_amount,l=o.progress_percentage,e=rt();let a=`ðŸ”” *REMINDER PEMBAYARAN KAS KELAS* ðŸ””

Assalamu'alaikum Wr. Wb.

${e} orang tua dari ${b.name} (${b.nickname})! ðŸ‘‹

ðŸ“‹ *Detail Pembayaran Multi-Bulan:*
â€¢ Periode: ${o.period_label}
â€¢ Total Pembayaran: ${v(o.total_amount)}
â€¢ Sudah Dibayar: ${v(o.paid_amount)}
â€¢ Sisa Pembayaran: ${v(f)}
â€¢ Progress: ${l}%

`;o.status==="pending"?a+=`âš ï¸ *Status: Belum Ada Pembayaran*
Mohon segera lakukan pembayaran untuk periode ${o.period_label}.

`:o.status==="partial"&&(a+=`â³ *Status: Pembayaran Sebagian*
Terima kasih sudah melakukan pembayaran sebagian. Mohon lanjutkan pembayaran untuk bulan-bulan berikutnya.

`),a+=`ðŸ’³ *Link Pembayaran:*
${o.payment_url}

ðŸ“ž *Bantuan:*
Jika ada pertanyaan atau kesulitan, silakan hubungi bendahara kelas.

Terima kasih atas kerjasamanya! ðŸ™

Wassalamu'alaikum Wr. Wb.

---
*Dikirim: ${e} (${dt()})*
*Sistem Kas Kelas Otomatis*
_Pesan ini dikirim secara otomatis_`;const x=`https://wa.me/${(s=b.phone)==null?void 0:s.replace(/\D/g,"").replace(/^0/,"62")}?text=${encodeURIComponent(a)}`;window.open(x,"_blank","noopener,noreferrer"),d.success(`ðŸ“¤ Reminder lengkap dikirim ke ${b.name}`,{timeout:4e3})}catch(b){console.error("Error sending reminder:",b),d.error("Gagal mengirim reminder")}},mt=async o=>{try{await navigator.clipboard.writeText(o.payment_url),d.success("Link berhasil disalin")}catch{d.error("Gagal menyalin link")}},lt=async o=>{try{await navigator.clipboard.writeText(o),d.success("Berhasil disalin")}catch{d.error("Gagal menyalin")}},ct=async o=>{await nt(o),O.value=!1},pt=async(o,s)=>{try{const b=(s==null?void 0:s.name)||"Siswa",f=(s==null?void 0:s.phone)||"",l=rt();let e=`Assalamu'alaikum Wr. Wb.

${l} orang tua dari ${b}

Dengan hormat, kami ingin mengingatkan mengenai pembayaran uang kas kelas.

`;o.type==="total"?e+=`ðŸ’° **Pembayaran ${o.description}**
Jumlah: ${v(o.amount)}

Pembayaran ini untuk beberapa bulan sekaligus, lebih praktis dan efisien.`:e+=`ðŸ“… **${o.description}**
Jumlah: ${v(o.amount)}

Pembayaran untuk bulan ini, bisa dibayar bertahap setiap bulan.`,e+=`

Untuk kemudahan pembayaran, Bapak/Ibu dapat menggunakan link pembayaran berikut:

${o.url}

Pembayaran dapat dilakukan melalui QRIS dengan berbagai metode:

âœ… Scan QR Code
âœ… E-Wallet (GoPay, OVO, DANA, ShopeePay)

Terima kasih atas perhatian dan kerjasamanya.

Wassalamu'alaikum Wr. Wb.

---
*Order ID: ${o.order_id}*
*Dikirim: ${l} (${dt()})*
*Sistem Kas Kelas Otomatis*`;const x=`https://wa.me/${f.replace(/\D/g,"").replace(/^0/,"62")}?text=${encodeURIComponent(e)}`;window.open(x,"_blank","noopener,noreferrer"),d.success(`ðŸ“± WhatsApp terbuka untuk ${b}
${o.description}`,{timeout:3e3})}catch(b){console.error("Error opening WhatsApp:",b),d.error("Gagal membuka WhatsApp")}},gt=o=>new Date(o).toLocaleDateString("id-ID",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),bt=async(o,s)=>{var b;if(confirm(`Tandai ${s.label} untuk ${(b=o.student)==null?void 0:b.name} sebagai LUNAS?

Jumlah: ${v(s.amount)}`))try{s.paid=!0,s.paid_at=new Date().toISOString();const f=o.month_details.filter(x=>x.paid).length,l=o.month_details.length,e=f*o.monthly_amount,a=Math.round(f/l*100);o.paid_amount=e,o.progress_percentage=a,a===100?o.status="completed":a>0&&(o.status="partial"),localStorage.setItem("multiMonthPayments",JSON.stringify(D.value)),d.success(`âœ… ${s.label} berhasil ditandai LUNAS!
Progress: ${a}%`,{timeout:4e3})}catch(f){console.error("Error marking month as paid:",f),d.error("Gagal menandai bulan sebagai lunas")}},xt=async o=>{var f,l;const s=o.month_details.filter(e=>!e.paid),b=s.length*o.monthly_amount;if(confirm(`Tandai SEMUA bulan yang belum lunas untuk ${(f=o.student)==null?void 0:f.name}?

${s.length} bulan Ã— ${v(o.monthly_amount)} = ${v(b)}`))try{const e=new Date().toISOString();s.forEach(a=>{a.paid=!0,a.paid_at=e}),o.paid_amount=o.total_amount,o.progress_percentage=100,o.status="completed",localStorage.setItem("multiMonthPayments",JSON.stringify(D.value)),d.success(`ðŸŽ‰ SEMUA bulan berhasil ditandai LUNAS!
${(l=o.student)==null?void 0:l.name} - ${v(b)}`,{timeout:5e3})}catch(e){console.error("Error marking all months as paid:",e),d.error("Gagal menandai semua bulan sebagai lunas")}},yt=async()=>{try{const o=ht(),s=window.open("","_blank");s&&(s.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
          <title>Laporan Multi-Month Payment - ${new Date().toLocaleDateString("id-ID")}</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            h1 { color: #1f2937; border-bottom: 2px solid #3b82f6; padding-bottom: 10px; }
            h2 { color: #374151; margin-top: 20px; }
            table { width: 100%; border-collapse: collapse; margin: 20px 0; }
            th, td { border: 1px solid #d1d5db; padding: 8px; text-align: left; }
            th { background-color: #f3f4f6; font-weight: bold; }
            .status-pending { color: #d97706; }
            .status-partial { color: #2563eb; }
            .status-completed { color: #059669; }
            .summary { background-color: #f9fafb; padding: 15px; border-radius: 8px; margin: 20px 0; }
            .footer { margin-top: 30px; text-align: center; color: #6b7280; font-size: 12px; }
            .progress-bar { width: 100%; height: 20px; background-color: #e5e7eb; border-radius: 10px; }
            .progress-fill { height: 100%; background-color: #3b82f6; border-radius: 10px; }
          </style>
        </head>
        <body>
          ${o}
          <div class="footer">
            Generated on ${new Date().toLocaleString("id-ID")} | Sistem Kas Kelas Multi-Month
          </div>
        </body>
        </html>
      `),s.document.close(),setTimeout(()=>{s.print()},500)),d.success("PDF Report Multi-Month siap untuk di-print/save")}catch(o){console.error("Error generating Multi-Month PDF:",o),d.error("Gagal membuat PDF report")}},ht=()=>{const o=q.value,s=o.length,b=o.filter(n=>n.status==="completed").length,f=o.filter(n=>n.status==="partial").length,l=o.filter(n=>n.status==="pending").length,e=o.reduce((n,u)=>n+u.total_amount,0),a=o.reduce((n,u)=>n+u.paid_amount,0);let x="";return o.forEach(n=>{var _;const u=`status-${n.status}`;x+=`
      <tr>
        <td>${((_=n.student)==null?void 0:_.name)||"-"}</td>
        <td>${n.period_label}</td>
        <td>${n.months} bulan</td>
        <td>${v(n.total_amount)}</td>
        <td>${v(n.paid_amount)}</td>
        <td>
          <div class="progress-bar">
            <div class="progress-fill" style="width: ${n.progress_percentage}%"></div>
          </div>
          ${n.progress_percentage}%
        </td>
        <td class="${u}">${j(n.status)}</td>
      </tr>
    `}),`
    <h1>ðŸ“Š Laporan Pembayaran Multi-Bulan</h1>

    <div class="summary">
      <h2>ðŸ“ˆ Ringkasan</h2>
      <p><strong>Total Siswa:</strong> ${s}</p>
      <p><strong>Lunas:</strong> ${b} | <strong>Sebagian:</strong> ${f} | <strong>Pending:</strong> ${l}</p>
      <p><strong>Total Amount:</strong> ${v(e)}</p>
      <p><strong>Total Terbayar:</strong> ${v(a)}</p>
      <p><strong>Progress Keseluruhan:</strong> ${Math.round(a/e*100)||0}%</p>
      <p><strong>Filter Status:</strong> ${U.value||"Semua Status"}</p>
    </div>

    <h2>ðŸ“‹ Detail Pembayaran Multi-Bulan</h2>
    <table>
      <thead>
        <tr>
          <th>Nama Siswa</th>
          <th>Periode</th>
          <th>Durasi</th>
          <th>Total Amount</th>
          <th>Terbayar</th>
          <th>Progress</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        ${x||'<tr><td colspan="7" style="text-align: center; color: #6b7280;">Tidak ada data pembayaran multi-bulan</td></tr>'}
      </tbody>
    </table>
  `},_t=async o=>{if(!o.payment_links||o.payment_links.length===0){d.warning("Tidak ada link pembayaran untuk dikirim");return}try{const s=o.student,b=(s==null?void 0:s.name)||"Siswa",f=(s==null?void 0:s.phone)||"",l=rt();let e=`Assalamu'alaikum Wr. Wb.

${l} orang tua dari ${b}

Dengan hormat, kami menyediakan beberapa opsi pembayaran kas kelas untuk kemudahan Bapak/Ibu:

ðŸ“‹ **OPSI PEMBAYARAN TERSEDIA**

`;o.payment_links.forEach((n,u)=>{e+=`${u+1}. ${n.type==="total"?"ðŸ’°":"ðŸ“…"} **${n.description}**
   Jumlah: ${v(n.amount)}
   Link: ${n.url}
   Order ID: ${n.order_id}

`}),e+=`Bapak/Ibu dapat memilih opsi yang paling sesuai:

${o.payment_links.find(n=>n.type==="total")?`âœ… Bayar sekaligus (lebih praktis)
`:""}${o.payment_links.find(n=>n.type==="individual")?`âœ… Bayar bertahap per bulan (lebih fleksibel)
`:""}
Pembayaran dapat dilakukan melalui QRIS dengan berbagai metode:

âœ… Scan QR Code
âœ… E-Wallet (GoPay, OVO, DANA, ShopeePay)

Terima kasih atas perhatian dan kerjasamanya.

Wassalamu'alaikum Wr. Wb.

---
*Dikirim: ${l} (${dt()})*
*Sistem Kas Kelas Otomatis*`;const x=`https://wa.me/${f.replace(/\D/g,"").replace(/^0/,"62")}?text=${encodeURIComponent(e)}`;window.open(x,"_blank","noopener,noreferrer"),d.success(`ðŸ“± WhatsApp terbuka untuk ${b}
${o.payment_links.length} opsi pembayaran dikirim`,{timeout:4e3})}catch(s){console.error("Error opening WhatsApp:",s),d.error("Gagal membuka WhatsApp")}},ot=o=>{const s=o.student;r.studentId=s.id,r.months=o.months,r.monthlyAmount=o.monthly_amount;const b=new Date;r.startMonth=b.getMonth()+1,r.year=b.getFullYear(),y.value=o,J.value=!0,d.info(`Editing pembayaran untuk ${s.name}`)},H=o=>{if(confirm(`Yakin ingin menghapus pembayaran multi-bulan untuk ${o.student.name}?

Periode: ${o.period_label}
Total: ${v(o.total_amount)}`))try{const s=D.value.findIndex(b=>b.id===o.id);s!==-1?(D.value.splice(s,1),d.success(`âœ… Pembayaran ${o.student.name} berhasil dihapus`)):d.warning("Pembayaran tidak ditemukan")}catch(s){console.error("Error deleting payment:",s),d.error("Gagal menghapus pembayaran")}};return Ut(()=>{}),(o,s)=>{var b,f,l,e;return c(),m("div",qt,[t("div",zt,[s[18]||(s[18]=t("div",null,[t("h3",{class:"text-lg font-semibold text-gray-900"},"Pembayaran Multi-Bulan"),t("p",{class:"text-sm text-gray-500 mt-1"},"Buat link pembayaran untuk beberapa bulan sekaligus")],-1)),t("button",{onClick:s[0]||(s[0]=a=>J.value=!0),class:"btn-primary w-full sm:w-auto"},[g(p(jt),{class:"w-4 h-4 mr-2"}),s[17]||(s[17]=E(" Buat Multi-Month ",-1))])]),t("div",Ht,[s[19]||(s[19]=t("h4",{class:"text-lg font-medium text-gray-900 mb-4"},"Template Cepat",-1)),t("div",Qt,[(c(),m(L,null,I($,a=>t("button",{key:a.months,onClick:x=>Z(a),class:"p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary-500 hover:bg-primary-50 transition-colors"},[t("div",Zt,[t("div",Xt,i(a.months),1),t("div",te,i(a.label),1),t("div",ee,i(v(a.amount)),1),t("div",se,i(a.months)+" Ã— Rp 50.000",1)])],8,Yt)),64))])]),t("div",ae,[s[25]||(s[25]=t("h4",{class:"text-lg font-medium text-gray-900 mb-4"},"âš¡ Aksi Cepat",-1)),t("div",ne,[s[24]||(s[24]=t("div",{class:"border rounded-lg p-4 bg-blue-50"},[t("h5",{class:"font-medium text-blue-900 mb-2"},"ðŸ’¡ Tips Marking Manual"),t("ul",{class:"text-sm text-blue-800 space-y-1"},[t("li",null,'â€¢ Klik tombol "âœ“ Tandai Lunas" untuk mark individual payment'),t("li",null,'â€¢ Gunakan "âœ“ Tandai Semua Lunas" untuk mark bulk dalam detail'),t("li",null,"â€¢ Progress akan otomatis terupdate"),t("li",null,"â€¢ Data tersimpan otomatis")])],-1)),t("div",le,[s[23]||(s[23]=t("h5",{class:"font-medium text-green-900 mb-2"},"ðŸ“Š Status Overview",-1)),t("div",oe,[t("div",ie,[s[20]||(s[20]=t("span",{class:"text-green-700"},"Lunas:",-1)),t("span",re,i(D.value.filter(a=>a.status==="completed").length),1)]),t("div",de,[s[21]||(s[21]=t("span",{class:"text-blue-700"},"Sebagian:",-1)),t("span",ue,i(D.value.filter(a=>a.status==="partial").length),1)]),t("div",me,[s[22]||(s[22]=t("span",{class:"text-yellow-700"},"Pending:",-1)),t("span",ce,i(D.value.filter(a=>a.status==="pending").length),1)])])])])]),t("div",pe,[t("div",ge,[s[29]||(s[29]=t("h4",{class:"text-lg font-medium text-gray-900"},"Pembayaran Multi-Bulan",-1)),t("div",be,[P(t("select",{"onUpdate:modelValue":s[1]||(s[1]=a=>U.value=a),class:"input-field w-auto"},s[26]||(s[26]=[t("option",{value:""},"Semua Status",-1),t("option",{value:"pending"},"Pending",-1),t("option",{value:"partial"},"Sebagian",-1),t("option",{value:"completed"},"Lunas",-1)]),512),[[K,U.value]]),t("button",{onClick:yt,class:"btn-secondary flex items-center",title:"Download PDF Report"},[g(p(Wt),{class:"w-4 h-4 mr-2"}),s[27]||(s[27]=t("span",{class:"hidden sm:inline"},"Download PDF",-1)),s[28]||(s[28]=t("span",{class:"sm:hidden"},"PDF",-1))])])]),t("div",xe,[t("table",ye,[s[30]||(s[30]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Siswa "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Periode "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Total "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Progress "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Status "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Aksi ")])],-1)),t("tbody",he,[(c(!0),m(L,null,I(q.value,a=>{var x,n,u,_,h;return c(),m("tr",{key:a.id},[t("td",ve,[t("div",fe,[t("div",ke,[t("span",_e,i((u=(n=(x=a.student)==null?void 0:x.name)==null?void 0:n.charAt(0))==null?void 0:u.toUpperCase()),1)]),t("div",null,[t("div",we,i((_=a.student)==null?void 0:_.name),1),t("div",$e,i((h=a.student)==null?void 0:h.nickname),1)])])]),t("td",Pe,[t("div",Ce,i(a.period_label),1),t("div",Se,i(a.months)+" bulan",1),a.payment_links?(c(),m("div",De,i(a.payment_links.length)+" link tersedia ",1)):C("",!0)]),t("td",Ae,[t("div",Me,i(v(a.total_amount)),1),t("div",Te,i(v(a.monthly_amount))+"/bulan",1)]),t("td",Le,[t("div",Ie,[t("div",{class:"bg-primary-600 h-2 rounded-full",style:wt({width:a.progress_percentage+"%"})},null,4)]),t("div",Be,i(a.paid_amount)+"/"+i(a.total_amount)+" ("+i(a.progress_percentage)+"%) ",1)]),t("td",je,[t("span",{class:F(ut(a.status))},i(j(a.status)),3)]),t("td",We,[t("div",Ue,[t("button",{onClick:S=>at(a),class:"text-primary-600 hover:text-primary-900",title:"Lihat Detail"},[g(p(Mt),{class:"w-4 h-4"})],8,Ee),t("button",{onClick:S=>nt(a),class:"text-success-600 hover:text-success-900",title:"Kirim Reminder"},[g(p(z),{class:"w-4 h-4"})],8,Ke),t("button",{onClick:S=>mt(a),class:"text-warning-600 hover:text-warning-900",title:"Copy Link"},[g(p(kt),{class:"w-4 h-4"})],8,Oe),t("button",{onClick:S=>ot(a),class:"text-blue-600 hover:text-blue-900",title:"Edit Pembayaran"},[g(p(Pt),{class:"w-4 h-4"})],8,Re),t("button",{onClick:S=>H(a),class:"text-red-600 hover:text-red-900",title:"Hapus Pembayaran"},[g(p(it),{class:"w-4 h-4"})],8,Ge)])])])}),128))])])]),t("div",Ne,[(c(!0),m(L,null,I(q.value,a=>{var x,n,u,_;return c(),m("div",{key:a.id,class:"bg-gray-50 rounded-lg p-4"},[t("div",Fe,[t("div",Ve,[t("div",Je,[t("span",qe,i((u=(n=(x=a.student)==null?void 0:x.name)==null?void 0:n.charAt(0))==null?void 0:u.toUpperCase()),1)]),t("div",null,[t("div",ze,i((_=a.student)==null?void 0:_.name),1),t("div",He,i(a.period_label),1)])]),t("span",{class:F(ut(a.status))},i(j(a.status)),3)]),t("div",Qe,[t("div",Ye,[t("div",{class:"bg-primary-600 h-2 rounded-full",style:wt({width:a.progress_percentage+"%"})},null,4)]),t("div",Ze,[s[31]||(s[31]=t("span",{class:"text-gray-600"},"Progress:",-1)),t("span",null,i(a.progress_percentage)+"%",1)]),t("div",Xe,[s[32]||(s[32]=t("span",{class:"text-gray-600"},"Total:",-1)),t("span",ts,i(v(a.total_amount)),1)])]),t("div",es,[t("button",{onClick:h=>at(a),class:"flex items-center justify-center text-primary-600 py-2"},[g(p(Mt),{class:"w-4 h-4 mr-1"}),s[33]||(s[33]=t("span",{class:"text-xs"},"Detail",-1))],8,ss),t("button",{onClick:h=>nt(a),class:"flex items-center justify-center text-success-600 py-2"},[g(p(z),{class:"w-4 h-4 mr-1"}),s[34]||(s[34]=t("span",{class:"text-xs"},"Kirim",-1))],8,as),t("button",{onClick:h=>mt(a),class:"flex items-center justify-center text-warning-600 py-2"},[g(p(kt),{class:"w-4 h-4 mr-1"}),s[35]||(s[35]=t("span",{class:"text-xs"},"Copy",-1))],8,ns),t("button",{onClick:h=>ot(a),class:"flex items-center justify-center text-blue-600 py-2"},[g(p(Pt),{class:"w-4 h-4 mr-1"}),s[36]||(s[36]=t("span",{class:"text-xs"},"Edit",-1))],8,ls)]),t("div",os,[t("button",{onClick:h=>H(a),class:"flex items-center justify-center text-red-600 py-2 w-full"},[g(p(it),{class:"w-4 h-4 mr-1"}),s[37]||(s[37]=t("span",{class:"text-xs"},"Hapus",-1))],8,is)])])}),128))])]),J.value?(c(),m("div",rs,[t("div",ds,[t("h3",us,i(y.value?"Edit Pembayaran Multi-Bulan":"Buat Pembayaran Multi-Bulan"),1),t("form",{onSubmit:Lt(st,["prevent"]),class:"space-y-4"},[t("div",null,[s[39]||(s[39]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Siswa",-1)),P(t("select",{"onUpdate:modelValue":s[2]||(s[2]=a=>r.studentId=a),required:"",class:"input-field"},[s[38]||(s[38]=t("option",{value:""},"Pilih Siswa",-1)),(c(!0),m(L,null,I(R.value,a=>(c(),m("option",{key:a.id,value:a.id},i(a.name)+" ("+i(a.nickname)+") ",9,ms))),128))],512),[[K,r.studentId]])]),t("div",cs,[t("div",null,[s[40]||(s[40]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Bulan Mulai",-1)),P(t("select",{"onUpdate:modelValue":s[3]||(s[3]=a=>r.startMonth=a),required:"",class:"input-field"},[(c(),m(L,null,I(w,a=>t("option",{key:a.value,value:a.value},i(a.label),9,ps)),64))],512),[[K,r.startMonth]])]),t("div",null,[s[41]||(s[41]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tahun",-1)),P(t("select",{"onUpdate:modelValue":s[4]||(s[4]=a=>r.year=a),required:"",class:"input-field"},[(c(),m(L,null,I(T,a=>t("option",{key:a,value:a},i(a),9,gs)),64))],512),[[K,r.year]])])]),t("div",null,[s[42]||(s[42]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Jumlah Bulan",-1)),P(t("select",{"onUpdate:modelValue":s[5]||(s[5]=a=>r.months=a),required:"",class:"input-field",onChange:et},[(c(),m(L,null,I(12,a=>t("option",{key:a,value:a},i(a)+" bulan ",9,bs)),64))],544),[[K,r.months,void 0,{number:!0}]])]),t("div",null,[s[43]||(s[43]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Jumlah per Bulan",-1)),P(t("input",{"onUpdate:modelValue":s[6]||(s[6]=a=>r.monthlyAmount=a),type:"number",min:"1",required:"",class:"input-field",onInput:et,placeholder:"50000"},null,544),[[Q,r.monthlyAmount,void 0,{number:!0}]])]),t("div",xs,[s[49]||(s[49]=t("h4",{class:"font-medium text-blue-900 mb-3"},"ðŸ’³ Opsi Generate Link Pembayaran",-1)),t("div",ys,[t("label",hs,[P(t("input",{"onUpdate:modelValue":s[7]||(s[7]=a=>r.linkType=a),type:"radio",value:"individual",class:"mt-1"},null,512),[[$t,r.linkType]]),t("div",null,[s[44]||(s[44]=t("div",{class:"font-medium text-gray-900"},"Link Individual per Bulan",-1)),t("div",vs," Generate "+i(r.months)+" link terpisah ("+i(v(r.monthlyAmount))+" per link) ",1),s[45]||(s[45]=t("div",{class:"text-xs text-green-600 mt-1"}," âœ… Orang tua bisa bayar bertahap â€¢ âœ… Tracking per bulan lebih detail ",-1))])]),t("label",fs,[P(t("input",{"onUpdate:modelValue":s[8]||(s[8]=a=>r.linkType=a),type:"radio",value:"single",class:"mt-1"},null,512),[[$t,r.linkType]]),t("div",null,[s[46]||(s[46]=t("div",{class:"font-medium text-gray-900"},"Link Total Sekaligus",-1)),t("div",ks," Generate 1 link untuk total "+i(v(r.monthlyAmount*r.months)),1),s[47]||(s[47]=t("div",{class:"text-xs text-blue-600 mt-1"}," âœ… Pembayaran sekaligus â€¢ âœ… Lebih praktis untuk orang tua ",-1))])]),t("label",_s,[P(t("input",{"onUpdate:modelValue":s[9]||(s[9]=a=>r.linkType=a),type:"radio",value:"both",class:"mt-1"},null,512),[[$t,r.linkType]]),s[48]||(s[48]=t("div",null,[t("div",{class:"font-medium text-gray-900"},"Kedua Opsi (Recommended)"),t("div",{class:"text-sm text-gray-600"}," Generate link individual + link total (orang tua pilih sendiri) "),t("div",{class:"text-xs text-purple-600 mt-1"}," âœ… Fleksibilitas maksimal â€¢ âœ… Cocok untuk semua preferensi ")],-1))])])]),t("div",ws,[s[54]||(s[54]=t("h4",{class:"font-medium text-gray-900 mb-2"},"ðŸ“‹ Ringkasan Pembayaran",-1)),t("div",$s,[t("div",Ps,[s[50]||(s[50]=t("span",null,"Periode:",-1)),t("span",null,i(r.months)+" bulan ("+i(Y())+")",1)]),t("div",Cs,[s[51]||(s[51]=t("span",null,"Jumlah per Bulan:",-1)),t("span",null,i(v(r.monthlyAmount)),1)]),t("div",Ss,[s[52]||(s[52]=t("span",null,"Total Pembayaran:",-1)),t("span",null,i(v(r.monthlyAmount*r.months)),1)])]),t("div",Ds,[s[53]||(s[53]=t("h5",{class:"font-medium text-gray-900 mb-2"},"ðŸ”— Link yang akan dibuat:",-1)),t("div",As,[r.linkType==="individual"||r.linkType==="both"?(c(),m("div",Ms," âœ… "+i(r.months)+" link individual ("+i(v(r.monthlyAmount))+" per link) ",1)):C("",!0),r.linkType==="single"||r.linkType==="both"?(c(),m("div",Ts," âœ… 1 link total sekaligus ("+i(v(r.monthlyAmount*r.months))+") ",1)):C("",!0),r.linkType==="both"?(c(),m("div",Ls," ðŸ’¡ Orang tua bisa pilih bayar bertahap atau sekaligus ")):C("",!0)])])]),t("div",Is,[t("button",{type:"button",onClick:X,class:"btn-secondary"}," Batal "),t("button",{type:"submit",disabled:B.value,class:"btn-primary"},i(B.value?"Menyimpan...":y.value?"Update Pembayaran":"Buat Pembayaran"),9,Bs)])],32)])])):C("",!0),O.value&&y.value?(c(),m("div",js,[t("div",Ws,[s[61]||(s[61]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Detail Pembayaran Multi-Bulan",-1)),t("div",Us,[t("div",Es,[t("div",Ks,[t("span",Os,i((l=(f=(b=y.value.student)==null?void 0:b.name)==null?void 0:f.charAt(0))==null?void 0:l.toUpperCase()),1)]),t("div",null,[t("h4",Rs,i((e=y.value.student)==null?void 0:e.name),1),t("p",Gs,i(y.value.period_label),1)])]),t("div",null,[t("div",Ns,[s[55]||(s[55]=t("span",{class:"text-sm font-medium text-gray-700"},"Progress Pembayaran",-1)),t("span",Fs,i(y.value.progress_percentage)+"%",1)]),t("div",Vs,[t("div",{class:"bg-primary-600 h-3 rounded-full",style:wt({width:y.value.progress_percentage+"%"})},null,4)]),t("div",Js,[t("span",null,i(v(y.value.paid_amount)),1),t("span",null,i(v(y.value.total_amount)),1)])]),t("div",null,[t("div",qs,[s[56]||(s[56]=t("h5",{class:"font-medium text-gray-900"},"Detail per Bulan",-1)),y.value.month_details&&y.value.month_details.some(a=>!a.paid)?(c(),m("button",{key:0,onClick:s[10]||(s[10]=a=>xt(y.value)),class:"text-green-600 hover:text-green-800 text-xs px-3 py-1 border border-green-300 rounded-full hover:bg-green-50"}," âœ“ Tandai Semua Lunas ")):C("",!0)]),t("div",zs,[(c(!0),m(L,null,I(y.value.month_details,a=>(c(),m("div",{key:a.month,class:F(["p-3 border rounded-lg",a.paid?"bg-green-50 border-green-200":"bg-gray-50 border-gray-200"])},[t("div",Hs,[t("span",Qs,i(a.label),1),t("div",Ys,[a.paid?(c(),m("span",Zs,"âœ“ Lunas")):(c(),m("span",Xs,"Belum bayar")),a.paid?C("",!0):(c(),m("button",{key:2,onClick:x=>bt(y.value,a),class:"text-green-600 hover:text-green-800 text-xs px-2 py-1 border border-green-300 rounded hover:bg-green-50",title:"Tandai Lunas"}," âœ“ Tandai Lunas ",8,ta))])]),t("div",ea,i(v(a.amount)),1),a.paid&&a.paid_at?(c(),m("div",sa," Dibayar: "+i(gt(a.paid_at)),1)):C("",!0)],2))),128))])]),t("div",null,[s[57]||(s[57]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"ðŸ”— Link Pembayaran yang Dibuat",-1)),y.value.payment_links&&y.value.payment_links.length>0?(c(),m("div",aa,[(c(!0),m(L,null,I(y.value.payment_links,a=>(c(),m("div",{key:a.id,class:F(["border rounded-lg p-3",a.type==="total"?"bg-blue-50 border-blue-200":"bg-green-50 border-green-200"])},[t("div",na,[t("div",la,[t("span",{class:F([a.type==="total"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800","px-2 py-1 rounded-full text-xs font-medium"])},i(a.type==="total"?"ðŸ’° Total Sekaligus":`ðŸ“… Bulan ${a.month}`),3),t("span",oa,i(v(a.amount)),1)]),t("div",ia,[t("button",{onClick:x=>lt(a.url),class:"p-1 text-gray-500 hover:text-gray-700",title:"Copy Link"},[g(p(ft),{class:"w-4 h-4"})],8,ra),t("button",{onClick:x=>pt(a,y.value.student),class:"p-1 text-green-500 hover:text-green-700",title:"Kirim via WhatsApp"},[g(p(z),{class:"w-4 h-4"})],8,da)])]),t("div",ua,i(a.description),1),t("div",ma," Order ID: "+i(a.order_id),1),t("div",ca,[t("input",{value:a.url,readonly:"",class:"input-field text-xs flex-1"},null,8,pa)])],2))),128))])):(c(),m("div",ga,[t("div",ba,[t("input",{value:y.value.payment_url,readonly:"",class:"input-field text-xs flex-1"},null,8,xa),t("button",{onClick:s[11]||(s[11]=a=>lt(y.value.payment_url)),class:"btn-secondary p-2"},[g(p(ft),{class:"w-4 h-4"})])])]))])]),t("div",ya,[t("div",ha,[t("button",{onClick:s[12]||(s[12]=a=>ot(y.value)),class:"btn-secondary text-blue-600 border-blue-300 hover:bg-blue-50 flex-1"},[g(p(Pt),{class:"w-4 h-4 mr-2"}),s[58]||(s[58]=E(" Edit ",-1))]),t("button",{onClick:s[13]||(s[13]=a=>H(y.value)),class:"btn-secondary text-red-600 border-red-300 hover:bg-red-50 flex-1"},[g(p(it),{class:"w-4 h-4 mr-2"}),s[59]||(s[59]=E(" Hapus ",-1))])]),y.value.payment_links&&y.value.payment_links.length>1?(c(),m("div",va,[t("button",{onClick:s[14]||(s[14]=a=>_t(y.value)),class:"btn-success flex-1"},[g(p(z),{class:"w-4 h-4 mr-2"}),E(" Kirim Semua Link ("+i(y.value.payment_links.length)+") ",1)])])):C("",!0),t("div",fa,[t("button",{onClick:s[15]||(s[15]=a=>O.value=!1),class:"btn-secondary flex-1"}," Tutup "),t("button",{onClick:s[16]||(s[16]=a=>ct(y.value)),class:"btn-success flex-1"},[g(p(z),{class:"w-4 h-4 mr-2"}),s[60]||(s[60]=E(" Kirim Reminder ",-1))])])])])])):C("",!0)])}}},_a={class:"space-y-6"},wa={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0"},$a={class:"flex flex-col sm:flex-row gap-3"},Pa={class:"border-b border-gray-200"},Ca={class:"-mb-px flex space-x-8"},Sa={key:0},Da={class:"grid grid-cols-1 md:grid-cols-4 gap-6"},Aa={class:"card p-6"},Ma={class:"flex items-center"},Ta={class:"p-2 bg-primary-100 rounded-lg"},La={class:"ml-4"},Ia={class:"text-2xl font-semibold text-gray-900"},Ba={class:"card p-6"},ja={class:"flex items-center"},Wa={class:"p-2 bg-warning-100 rounded-lg"},Ua={class:"ml-4"},Ea={class:"text-2xl font-semibold text-gray-900"},Ka={class:"card p-6"},Oa={class:"flex items-center"},Ra={class:"p-2 bg-success-100 rounded-lg"},Ga={class:"ml-4"},Na={class:"text-2xl font-semibold text-gray-900"},Fa={class:"card p-6"},Va={class:"flex items-center"},Ja={class:"p-2 bg-success-100 rounded-lg"},qa={class:"ml-4"},za={class:"text-2xl font-semibold text-gray-900"},Ha={class:"card p-4 sm:p-6"},Qa={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"},Ya={class:"flex items-end"},Za=["disabled"],Xa={key:0,class:"mt-4"},tn={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-2 max-h-48 overflow-y-auto"},en=["value"],sn={class:"text-sm"},an={class:"card p-4 sm:p-6"},nn={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"},ln={class:"sm:col-span-2"},on={key:0,class:"mt-4"},rn={key:1,class:"mt-4"},dn={class:"grid grid-cols-1 gap-2 max-h-48 overflow-y-auto"},un=["value"],mn={class:"text-sm"},cn={class:"flex items-center justify-between mt-4 pt-4 border-t border-gray-200"},pn={class:"text-sm text-gray-600"},gn={class:"font-medium"},bn=["disabled"],xn={class:"card p-4 sm:p-6"},yn={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 space-y-2 sm:space-y-0"},hn={class:"flex space-x-2"},vn={class:"block sm:hidden space-y-4"},fn={class:"flex items-center justify-between mb-2"},kn={class:"flex items-center"},_n={class:"w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center mr-3"},wn={class:"text-primary-600 font-semibold text-xs"},$n={class:"font-medium text-sm"},Pn={class:"text-gray-500 text-xs"},Cn={class:"space-y-1 text-sm"},Sn={class:"flex justify-between"},Dn={class:"font-medium"},An={class:"flex justify-between"},Mn={class:"text-right"},Tn={class:"flex justify-between"},Ln={class:"font-mono text-xs"},In={class:"flex justify-between"},Bn={class:"text-xs"},jn={class:"grid grid-cols-3 gap-2 mt-3 pt-3 border-t border-gray-200"},Wn=["onClick"],Un=["onClick"],En=["onClick"],Kn=["onClick"],On=["onClick"],Rn={class:"flex justify-center mt-2"},Gn=["onClick"],Nn={class:"hidden sm:block overflow-x-auto"},Fn={class:"min-w-full divide-y divide-gray-200"},Vn={class:"bg-white divide-y divide-gray-200"},Jn={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},qn={class:"flex items-center"},zn={class:"w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center mr-3"},Hn={class:"text-primary-600 font-semibold text-xs"},Qn={class:"font-medium"},Yn={class:"text-gray-500 text-xs"},Zn={class:"px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-500"},Xn={class:"px-6 py-4 text-sm text-gray-500"},tl={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},el={class:"px-6 py-4 whitespace-nowrap"},sl={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},al={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},nl={class:"flex items-center space-x-2"},ll=["onClick"],ol=["onClick"],il=["onClick"],rl=["onClick"],dl=["onClick"],ul=["onClick"],ml={key:0,class:"text-center py-8"},cl={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},pl={class:"bg-white rounded-lg max-w-md w-full mx-4 p-4 sm:p-6"},gl=["value"],bl={class:"flex justify-end space-x-3 pt-4"},xl=["disabled"],yl={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},hl={class:"bg-white rounded-lg max-w-md w-full mx-4 p-4 sm:p-6"},vl={class:"space-y-4"},fl={class:"text-sm text-gray-900"},kl={class:"text-sm text-gray-900"},_l={class:"text-sm font-mono text-gray-900"},wl={class:"flex items-center space-x-2"},$l=["value"],Pl={class:"flex justify-end space-x-3 pt-4"},Cl={key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},Sl={class:"bg-white rounded-lg max-w-md w-full mx-4 p-4 sm:p-6"},Dl={class:"space-y-4"},Al={class:"block text-sm font-medium text-gray-700 mb-1"},Ml=["value"],Tl={class:"flex items-center space-x-2"},Ll=["value"],Il={class:"flex justify-between space-x-3 pt-4"},Bl={key:1},Jl={__name:"Payments",setup(V){const k=It(),d=Bt(),J=Et(),O=M(!1),y=M(!1),B=M(null),U=M(""),r=M(!1),D=M(!1),R=M("single"),w=vt({amount:5e4,description:"Kas Bulanan",target:"all",selectedStudents:[]}),T=vt({studentId:"",amount:0,description:""}),$=vt({target:"pending",delayMinutes:1,template:"reminder",customMessage:"",selectedPayments:[]}),q=M(!1),v=M(!1),j=M({phone:"",message:"",studentName:""}),ut=tt(()=>k.paymentLinks.filter(l=>l.status==="pending")),Y=tt(()=>k.paymentLinks.filter(l=>l.status==="completed")),et=tt(()=>Y.value.reduce((l,e)=>l+e.amount,0)),Z=tt(()=>{let l=[...k.paymentLinks];return U.value&&(l=l.filter(e=>e.status===U.value)),l.sort((e,a)=>new Date(a.created_at)-new Date(e.created_at))}),A=l=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(l),X=l=>Vt(new Date(l),"dd MMM yyyy HH:mm",{locale:Jt}),st=l=>({pending:"Pending",completed:"Selesai",expired:"Expired"})[l]||l,at=l=>{const e={pending:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-warning-100 text-warning-800",completed:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-success-100 text-success-800",expired:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800"};return e[l]||e.pending},nt=async()=>{try{r.value=!0;let l=[];const e=new Date().toLocaleDateString("id-ID",{month:"long",year:"numeric"});if(w.target==="all")l=k.students;else if(w.target==="unpaid"){if(l=k.unpaidStudentsThisMonth,l.length===0){d.info(`Semua siswa sudah membayar untuk bulan ${e}! ðŸŽ‰`);return}}else w.target==="selected"&&(l=k.students.filter(a=>w.selectedStudents.includes(a.id)));if(l.length>5&&!confirm(`Generate link pembayaran untuk ${l.length} siswa?

Bulan: ${e}
Jumlah: ${A(w.amount)}
Keterangan: ${w.description}`))return;try{const a=await k.generateBulkPaymentLinks(w.amount,w.description,w.target==="unpaid"),x=a.filter(u=>u.success).length,n=a.filter(u=>!u.success).length;x>0&&d.success(`âœ… Berhasil generate ${x} link pembayaran untuk bulan ${e}`),n>0&&d.warning(`âš ï¸ ${n} link gagal dibuat (mungkin siswa sudah bayar)`)}catch(a){if(a.message.includes("sudah membayar"))d.info(a.message);else throw a}w.selectedStudents=[]}catch(l){d.error("Gagal generate link pembayaran: "+l.message),console.error("Error generating bulk links:",l)}finally{r.value=!1}},mt=async()=>{try{D.value=!0;const l=k.students.find(a=>a.id===T.studentId),e=new Date().toLocaleDateString("id-ID",{month:"long",year:"numeric"});await k.generatePaymentLink(T.studentId,T.amount,T.description),d.success(`âœ… Link pembayaran berhasil dibuat untuk ${l==null?void 0:l.name} - ${e}`),O.value=!1,T.studentId="",T.amount=0,T.description=""}catch(l){l.message.includes("sudah membayar")?d.warning(l.message):d.error("Gagal membuat link pembayaran: "+l.message),console.error("Error creating payment link:",l)}finally{D.value=!1}},lt=async l=>{try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(l.payment_url),d.success("Link berhasil disalin ke clipboard");else{const e=document.createElement("textarea");e.value=l.payment_url,e.style.position="fixed",e.style.left="-999999px",e.style.top="-999999px",document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("copy"),d.success("Link berhasil disalin")}catch(a){d.error("Gagal menyalin link - silakan copy manual"),console.error("Copy fallback failed:",a)}finally{document.body.removeChild(e)}}}catch(e){console.error("Error copying payment link:",e),d.error("Gagal menyalin link - silakan copy manual")}},ct=l=>{pt(l)},pt=async l=>{try{const e=l.student,a=(e==null?void 0:e.name)||"Siswa",x=(e==null?void 0:e.nickname)||a,n=(e==null?void 0:e.phone)||"",u=rt(),_=`Assalamu'alaikum Wr. Wb.

${u} orang tua dari ${a}

Dengan hormat, kami ingin mengingatkan mengenai pembayaran uang kas kelas untuk bulan ini sebesar ${A(l.amount)}

Untuk kemudahan pembayaran, Bapak/Ibu dapat menggunakan link pembayaran berikut:

${l.payment_url}

Pembayaran dapat dilakukan melalui QRIS dengan berbagai metode:

âœ… Scan QR Code
âœ… E-Wallet (GoPay, OVO, DANA, ShopeePay)

Terima kasih atas perhatian dan kerjasamanya.

Wassalamu'alaikum Wr. Wb.

---
*Order ID: ${l.order_id}*
*Dikirim: ${u} (${dt()})*
*Sistem Kas Kelas Otomatis*`,S=`https://wa.me/${n.replace(/\D/g,"").replace(/^0/,"62")}?text=${encodeURIComponent(_)}`;window.open(S,"_blank","noopener,noreferrer"),d.success(`ðŸ“± WhatsApp terbuka untuk ${a}`,{timeout:3e3}),y.value=!1}catch(e){console.error("Error opening WhatsApp:",e),d.error("Gagal membuka WhatsApp")}},gt=async l=>{try{const e=await Nt.checkTransactionStatus(l.amount,l.order_id);e.status==="completed"&&l.status==="pending"?(await k.db.updatePaymentLink(l.id,{status:"completed",payment_method:e.payment_method||"qris",completed_at:e.completed_at||new Date().toISOString()}),await k.addTransaction({type:"income",amount:l.amount,description:l.description,student_id:l.student_id,payment_method:e.payment_method||"qris",order_id:l.order_id,status:"completed",created_at:e.completed_at||new Date().toISOString()}),d.success("Status pembayaran berhasil diupdate")):d.info(`Status: ${e.status||"pending"}`)}catch(e){d.error("Gagal mengecek status pembayaran"),console.error("Error checking payment status:",e)}},bt=async l=>{var a,x,n;const e=new Date().toLocaleDateString("id-ID",{month:"long",year:"numeric"});if(confirm(`Tandai pembayaran ${(a=l.student)==null?void 0:a.name} sebagai LUNAS untuk bulan ${e}?

Jumlah: ${A(l.amount)}
Keterangan: ${l.description}

âš ï¸ Ini akan menambah saldo kas kelas dan menandai siswa sebagai sudah bayar bulan ini.`))try{const u=new Date().toISOString(),_=u.slice(0,7);await k.updatePaymentLink(l.id,{status:"completed",payment_method:"manual",completed_at:u,month:_,notes:`Ditandai lunas secara manual oleh admin pada ${new Date().toLocaleString("id-ID")}`}),await k.addTransaction({type:"income",amount:l.amount,description:`${l.description} - ${e} (Manual)`,student_id:l.student_id,payment_method:"manual",order_id:l.order_id,status:"completed",month:_,created_at:u,notes:`Pembayaran manual - ${(x=l.student)==null?void 0:x.name} untuk ${e}`}),await k.fetchPaymentLinks(),await k.fetchTransactions();const h=k.currentBalance;d.success(`âœ… ${(n=l.student)==null?void 0:n.name} berhasil ditandai LUNAS!
ðŸ’° Saldo kas bertambah: ${A(l.amount)}
ðŸ“Š Saldo saat ini: ${A(h)}`,{timeout:6e3})}catch(u){console.error("Error marking payment as paid:",u),d.error("Gagal menandai pembayaran sebagai lunas: "+u.message)}},xt=async l=>{if(confirm("Apakah Anda yakin ingin menghapus link pembayaran ini?"))try{await k.deletePaymentLink(l.id),d.success("Link pembayaran berhasil dihapus")}catch(e){d.error("Gagal menghapus link pembayaran"),console.error("Error deleting payment link:",e)}},yt=l=>{l.order_id?J.push({path:"/invoice",query:{orderId:l.order_id}}):l.student_id?J.push({path:"/invoice",query:{studentId:l.student_id}}):d.warning("Data pembayaran tidak lengkap untuk membuat invoice")},ht=async l=>{try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(l),d.success("Berhasil disalin ke clipboard");else{const e=document.createElement("textarea");e.value=l,e.style.position="fixed",e.style.left="-999999px",e.style.top="-999999px",document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("copy"),d.success("Berhasil disalin")}catch(a){d.warning("Silakan copy manual dari text yang ditampilkan"),console.error("Copy fallback failed:",a)}finally{document.body.removeChild(e)}}}catch(e){console.error("Error copying to clipboard:",e),d.error("Gagal menyalin - silakan copy manual")}},_t=async()=>{const l=`Nomor: ${j.value.phone}

Pesan:
${j.value.message}`;try{await navigator.clipboard.writeText(l),d.success("Pesan dan nomor berhasil disalin!")}catch{d.error("Gagal menyalin")}},ot=()=>{const l=j.value.phone.replace(/[^\d]/g,""),e=encodeURIComponent(j.value.message),a=`https://web.whatsapp.com/send?phone=${l}&text=${e}`;window.open(a,"_blank"),d.info("WhatsApp Web dibuka di tab baru")},H=()=>$.target==="pending"?k.paymentLinks.filter(l=>l.status==="pending"):$.target==="all"?k.paymentLinks:$.target==="selected"?k.paymentLinks.filter(l=>$.selectedPayments.includes(l.id)):[],o=l=>{var n;if($.template==="custom")return $.customMessage.replace("{nama}",((n=l.student)==null?void 0:n.name)||"").replace("{jumlah}",A(l.amount)).replace("{keterangan}",l.description).replace("{link}",l.payment_url);const e=l.student,a=(e==null?void 0:e.name)||"Siswa",x=rt();return`Assalamu'alaikum Wr. Wb.

${x} orang tua dari ${a}

Dengan hormat, kami ingin mengingatkan mengenai pembayaran uang kas kelas untuk bulan ini sebesar ${A(l.amount)}

Untuk kemudahan pembayaran, Bapak/Ibu dapat menggunakan link pembayaran berikut:

${l.payment_url}

Pembayaran dapat dilakukan melalui QRIS dengan berbagai metode:

âœ… Scan QR Code
âœ… E-Wallet (GoPay, OVO, DANA, ShopeePay)

Terima kasih atas perhatian dan kerjasamanya.

Wassalamu'alaikum Wr. Wb.

---
*Order ID: ${l.order_id}*
*Dikirim: ${x} (${dt()})*
*Sistem Kas Kelas Otomatis*`},s=async()=>{try{const l=b(),e=document.createElement("div");e.innerHTML=l,e.style.position="absolute",e.style.left="-9999px",e.style.top="-9999px",document.body.appendChild(e);const a=window.open("","_blank");a&&(a.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
          <title>Laporan Pembayaran - ${new Date().toLocaleDateString("id-ID")}</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            h1 { color: #1f2937; border-bottom: 2px solid #3b82f6; padding-bottom: 10px; }
            h2 { color: #374151; margin-top: 20px; }
            table { width: 100%; border-collapse: collapse; margin: 20px 0; }
            th, td { border: 1px solid #d1d5db; padding: 8px; text-align: left; }
            th { background-color: #f3f4f6; font-weight: bold; }
            .status-pending { color: #d97706; }
            .status-completed { color: #059669; }
            .status-expired { color: #dc2626; }
            .summary { background-color: #f9fafb; padding: 15px; border-radius: 8px; margin: 20px 0; }
            .footer { margin-top: 30px; text-align: center; color: #6b7280; font-size: 12px; }
          </style>
        </head>
        <body>
          ${l}
          <div class="footer">
            Generated on ${new Date().toLocaleString("id-ID")} | Sistem Kas Kelas
          </div>
        </body>
        </html>
      `),a.document.close(),setTimeout(()=>{a.print()},500)),document.body.removeChild(e),d.success("PDF Report siap untuk di-print/save")}catch(l){console.error("Error generating PDF:",l),d.error("Gagal membuat PDF report")}},b=()=>{const l=Z.value,e=l.reduce((u,_)=>u+_.amount,0),a=l.filter(u=>u.status==="pending").length,x=l.filter(u=>u.status==="completed").length;let n="";return l.forEach(u=>{var h,S;const _=`status-${u.status}`;n+=`
      <tr>
        <td>${((h=u.student)==null?void 0:h.name)||"-"}</td>
        <td>${((S=u.student)==null?void 0:S.nickname)||"-"}</td>
        <td>${A(u.amount)}</td>
        <td>${u.description}</td>
        <td class="${_}">${st(u.status)}</td>
        <td>${X(u.created_at)}</td>
        <td style="font-family: monospace; font-size: 11px;">${u.order_id}</td>
      </tr>
    `}),`
    <h1>ðŸ“Š Laporan Pembayaran Kas Kelas</h1>

    <div class="summary">
      <h2>ðŸ“ˆ Ringkasan</h2>
      <p><strong>Total Link Pembayaran:</strong> ${l.length}</p>
      <p><strong>Pending:</strong> ${a} | <strong>Selesai:</strong> ${x}</p>
      <p><strong>Total Amount:</strong> ${A(e)}</p>
      <p><strong>Filter Status:</strong> ${U.value||"Semua Status"}</p>
    </div>

    <h2>ðŸ“‹ Detail Pembayaran</h2>
    <table>
      <thead>
        <tr>
          <th>Nama Siswa</th>
          <th>Nickname</th>
          <th>Jumlah</th>
          <th>Keterangan</th>
          <th>Status</th>
          <th>Tanggal Dibuat</th>
          <th>Order ID</th>
        </tr>
      </thead>
      <tbody>
        ${n||'<tr><td colspan="7" style="text-align: center; color: #6b7280;">Tidak ada data pembayaran</td></tr>'}
      </tbody>
    </table>
  `},f=async()=>{try{q.value=!0;const l=H();if(l.length===0){d.error("Tidak ada pembayaran yang dipilih");return}const e=[],a=$.delayMinutes*60;for(let u=0;u<l.length;u++){const _=l[u],h=_.student,S=(h==null?void 0:h.phone)||"";try{u>0&&await new Promise(N=>setTimeout(N,a*1e3));const G=o(_),Dt=`https://wa.me/${S.replace(/\D/g,"").replace(/^0/,"62")}?text=${encodeURIComponent(G)}`;if(u===0)window.open(Dt,"_blank","noopener,noreferrer");else{const N=document.createElement("a");N.href=Dt,N.target="_blank",N.rel="noopener noreferrer",N.style.display="none",document.body.appendChild(N),N.click(),document.body.removeChild(N)}e.push({recipient:h==null?void 0:h.name,phone:S,success:!0}),d.success(`ðŸ“± ${u+1}/${l.length} - WhatsApp dibuka untuk ${h==null?void 0:h.name}`,{timeout:2e3})}catch(G){e.push({recipient:h==null?void 0:h.name,phone:S,success:!1,error:G.message}),d.error(`âŒ Gagal membuka WhatsApp untuk ${h==null?void 0:h.name}`)}}const x=e.filter(u=>u.success).length,n=e.filter(u=>!u.success).length;d.success(`ðŸŽ‰ Selesai! ${x} WhatsApp terbuka${n>0?`, ${n} gagal`:""}`),$.selectedPayments=[]}catch(l){d.error("Gagal mengirim pesan massal"),console.error("Error sending bulk messages:",l)}finally{q.value=!1}};return(l,e)=>{var x;const a=Kt("router-link");return c(),m("div",_a,[t("div",wa,[e[26]||(e[26]=t("div",null,[t("h1",{class:"text-xl sm:text-2xl font-semibold text-gray-900"},"Link Pembayaran"),t("p",{class:"text-sm text-gray-500 mt-1"},"Kelola link pembayaran untuk kas kelas")],-1)),t("div",$a,[g(a,{to:"/invoice",class:"btn-outline w-full sm:w-auto inline-flex items-center justify-center"},{default:Ot(()=>[g(p(Ct),{class:"w-4 h-4 mr-2"}),e[22]||(e[22]=t("span",{class:"hidden sm:inline"},"Lihat Invoice",-1)),e[23]||(e[23]=t("span",{class:"sm:hidden"},"Invoice",-1))]),_:1,__:[22,23]}),t("button",{onClick:e[0]||(e[0]=n=>O.value=!0),class:"btn-primary w-full sm:w-auto"},[g(p(jt),{class:"w-4 h-4 mr-2"}),e[24]||(e[24]=t("span",{class:"hidden sm:inline"},"Buat Link Bayar",-1)),e[25]||(e[25]=t("span",{class:"sm:hidden"},"Buat Link",-1))])])]),t("div",Pa,[t("nav",Ca,[t("button",{onClick:e[1]||(e[1]=n=>R.value="single"),class:F(["whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm",R.value==="single"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Pembayaran Bulanan ",2),t("button",{onClick:e[2]||(e[2]=n=>R.value="multi"),class:F(["whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm",R.value==="multi"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},e[27]||(e[27]=[E(" Multi-Bulan ",-1),t("span",{class:"ml-2 bg-green-100 text-green-800 text-xs font-medium px-2 py-0.5 rounded-full"}," NEW ",-1)]),2)])]),R.value==="single"?(c(),m("div",Sa,[t("div",Da,[t("div",Aa,[t("div",Ma,[t("div",Ta,[g(p(Rt),{class:"w-6 h-6 text-primary-600"})]),t("div",La,[e[28]||(e[28]=t("p",{class:"text-sm font-medium text-gray-600"},"Total Link",-1)),t("p",Ia,i(p(k).paymentLinks.length),1)])])]),t("div",Ba,[t("div",ja,[t("div",Wa,[g(p(Ft),{class:"w-6 h-6 text-warning-600"})]),t("div",Ua,[e[29]||(e[29]=t("p",{class:"text-sm font-medium text-gray-600"},"Pending",-1)),t("p",Ea,i(ut.value.length),1)])])]),t("div",Ka,[t("div",Oa,[t("div",Ra,[g(p(St),{class:"w-6 h-6 text-success-600"})]),t("div",Ga,[e[30]||(e[30]=t("p",{class:"text-sm font-medium text-gray-600"},"Selesai",-1)),t("p",Na,i(Y.value.length),1)])])]),t("div",Fa,[t("div",Va,[t("div",Ja,[g(p(Gt),{class:"w-6 h-6 text-success-600"})]),t("div",qa,[e[31]||(e[31]=t("p",{class:"text-sm font-medium text-gray-600"},"Total Terkumpul",-1)),t("p",za,i(A(et.value)),1)])])])]),t("div",Ha,[e[37]||(e[37]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Generate Link Cepat",-1)),t("div",Qa,[t("div",null,[e[32]||(e[32]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Jumlah",-1)),P(t("input",{"onUpdate:modelValue":e[3]||(e[3]=n=>w.amount=n),type:"number",min:"1",class:"input-field",placeholder:"Contoh: 50000"},null,512),[[Q,w.amount,void 0,{number:!0}]])]),t("div",null,[e[33]||(e[33]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Keterangan",-1)),P(t("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>w.description=n),type:"text",class:"input-field",placeholder:"Contoh: Kas Bulanan Februari"},null,512),[[Q,w.description]])]),t("div",null,[e[35]||(e[35]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Target Siswa",-1)),P(t("select",{"onUpdate:modelValue":e[5]||(e[5]=n=>w.target=n),class:"input-field"},e[34]||(e[34]=[t("option",{value:"all"},"Semua Siswa",-1),t("option",{value:"unpaid"},"Siswa Belum Bayar",-1),t("option",{value:"selected"},"Pilih Manual",-1)]),512),[[K,w.target]])]),t("div",Ya,[t("button",{onClick:nt,disabled:!w.amount||!w.description||r.value,class:"btn-primary w-full"},i(r.value?"Generating...":"Generate Links"),9,Za)])]),w.target==="selected"?(c(),m("div",Xa,[e[36]||(e[36]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Pilih Siswa",-1)),t("div",tn,[(c(!0),m(L,null,I(p(k).students,n=>(c(),m("label",{key:n.id,class:"flex items-center space-x-2 p-2 border rounded-lg hover:bg-gray-50"},[P(t("input",{type:"checkbox",value:n.id,"onUpdate:modelValue":e[6]||(e[6]=u=>w.selectedStudents=u),class:"rounded"},null,8,en),[[At,w.selectedStudents]]),t("span",sn,i(n.name),1)]))),128))])])):C("",!0)]),t("div",an,[e[47]||(e[47]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Kirim Pesan WhatsApp Massal",-1)),e[48]||(e[48]=t("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4"},[t("p",{class:"text-sm text-yellow-800"},[t("strong",null,"Catatan:"),E(" Pengiriman pesan langsung dari browser mungkin diblokir oleh CORS policy. Untuk production yang stabil, implementasikan API calls melalui backend server. ")])],-1)),t("div",nn,[t("div",null,[e[39]||(e[39]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Target Pesan",-1)),P(t("select",{"onUpdate:modelValue":e[7]||(e[7]=n=>$.target=n),class:"input-field"},e[38]||(e[38]=[t("option",{value:"pending"},"Link Pembayaran Pending",-1),t("option",{value:"all"},"Semua Link Pembayaran",-1),t("option",{value:"selected"},"Pilih Manual",-1)]),512),[[K,$.target]])]),t("div",null,[e[40]||(e[40]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Jeda Antar Pesan (menit)",-1)),P(t("input",{"onUpdate:modelValue":e[8]||(e[8]=n=>$.delayMinutes=n),type:"number",min:"1",max:"60",class:"input-field",placeholder:"1"},null,512),[[Q,$.delayMinutes,void 0,{number:!0}]])]),t("div",ln,[e[42]||(e[42]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Template Pesan",-1)),P(t("select",{"onUpdate:modelValue":e[9]||(e[9]=n=>$.template=n),class:"input-field"},e[41]||(e[41]=[t("option",{value:"reminder"},"Pengingat Pembayaran",-1),t("option",{value:"custom"},"Pesan Kustom",-1)]),512),[[K,$.template]])])]),$.template==="custom"?(c(),m("div",on,[e[43]||(e[43]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Pesan Kustom",-1)),P(t("textarea",{"onUpdate:modelValue":e[10]||(e[10]=n=>$.customMessage=n),rows:"4",class:"input-field",placeholder:"Tulis pesan kustom di sini..."},null,512),[[Q,$.customMessage]]),e[44]||(e[44]=t("p",{class:"text-sm text-gray-500 mt-1"}," Gunakan {nama}, {jumlah}, {keterangan}, {link} untuk data dinamis ",-1))])):C("",!0),$.target==="selected"?(c(),m("div",rn,[e[45]||(e[45]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Pilih Link Pembayaran",-1)),t("div",dn,[(c(!0),m(L,null,I(p(k).paymentLinks,n=>{var u;return c(),m("label",{key:n.id,class:"flex items-center space-x-2 p-2 border rounded-lg hover:bg-gray-50"},[P(t("input",{type:"checkbox",value:n.id,"onUpdate:modelValue":e[11]||(e[11]=_=>$.selectedPayments=_),class:"rounded"},null,8,un),[[At,$.selectedPayments]]),t("span",mn,i((u=n.student)==null?void 0:u.name)+" - "+i(A(n.amount))+" - "+i(n.description),1)])}),128))])])):C("",!0),t("div",cn,[t("div",pn,[t("span",gn,i(H().length),1),e[46]||(e[46]=E(" pesan akan dikirim ",-1))]),t("button",{onClick:f,disabled:q.value||H().length===0,class:"btn-primary"},i(q.value?"Mengirim...":"Kirim Pesan WhatsApp"),9,bn)])]),t("div",xn,[t("div",yn,[e[52]||(e[52]=t("h3",{class:"text-lg font-semibold text-gray-900"},"Daftar Link Pembayaran",-1)),t("div",hn,[P(t("select",{"onUpdate:modelValue":e[12]||(e[12]=n=>U.value=n),class:"input-field w-full sm:w-auto"},e[49]||(e[49]=[t("option",{value:""},"Semua Status",-1),t("option",{value:"pending"},"Pending",-1),t("option",{value:"completed"},"Selesai",-1),t("option",{value:"expired"},"Expired",-1)]),512),[[K,U.value]]),t("button",{onClick:s,class:"btn-secondary flex items-center",title:"Download PDF Report"},[g(p(Wt),{class:"w-4 h-4 mr-2"}),e[50]||(e[50]=t("span",{class:"hidden sm:inline"},"Download PDF",-1)),e[51]||(e[51]=t("span",{class:"sm:hidden"},"PDF",-1))])])]),t("div",vn,[(c(!0),m(L,null,I(Z.value,n=>{var u,_,h,S,G;return c(),m("div",{key:n.id,class:"bg-gray-50 rounded-lg p-4"},[t("div",fn,[t("div",kn,[t("div",_n,[t("span",wn,i((h=(_=(u=n.student)==null?void 0:u.nickname)==null?void 0:_.charAt(0))==null?void 0:h.toUpperCase()),1)]),t("div",null,[t("div",$n,i((S=n.student)==null?void 0:S.name),1),t("div",Pn,i((G=n.student)==null?void 0:G.nickname),1)])]),t("span",{class:F(at(n.status))},i(st(n.status)),3)]),t("div",Cn,[t("div",Sn,[e[53]||(e[53]=t("span",{class:"text-gray-600"},"Jumlah:",-1)),t("span",Dn,i(A(n.amount)),1)]),t("div",An,[e[54]||(e[54]=t("span",{class:"text-gray-600"},"Keterangan:",-1)),t("span",Mn,i(n.description),1)]),t("div",Tn,[e[55]||(e[55]=t("span",{class:"text-gray-600"},"Order ID:",-1)),t("span",Ln,i(n.order_id),1)]),t("div",In,[e[56]||(e[56]=t("span",{class:"text-gray-600"},"Dibuat:",-1)),t("span",Bn,i(X(n.created_at)),1)])]),t("div",jn,[t("button",{onClick:W=>lt(n),class:"flex items-center justify-center text-primary-600 hover:text-primary-900 py-2",title:"Copy Link"},[g(p(kt),{class:"w-4 h-4 mr-1"}),e[57]||(e[57]=t("span",{class:"text-xs"},"Copy",-1))],8,Wn),t("button",{onClick:W=>ct(n),class:"flex items-center justify-center text-success-600 hover:text-success-900 py-2",title:"Kirim via WhatsApp"},[g(p(z),{class:"w-4 h-4 mr-1"}),e[58]||(e[58]=t("span",{class:"text-xs"},"Kirim",-1))],8,Un),t("button",{onClick:W=>yt(n),class:"flex items-center justify-center text-purple-600 hover:text-purple-900 py-2",title:"Lihat Invoice"},[g(p(Ct),{class:"w-4 h-4 mr-1"}),e[59]||(e[59]=t("span",{class:"text-xs"},"Invoice",-1))],8,En),n.status==="pending"?(c(),m("button",{key:0,onClick:W=>bt(n),class:"flex items-center justify-center text-green-600 hover:text-green-900 py-2",title:"Tandai Lunas"},[g(p(St),{class:"w-4 h-4 mr-1"}),e[60]||(e[60]=t("span",{class:"text-xs"},"Lunas",-1))],8,Kn)):C("",!0),t("button",{onClick:W=>gt(n),class:"flex items-center justify-center text-warning-600 hover:text-warning-900 py-2",title:"Cek Status"},[g(p(Tt),{class:"w-4 h-4 mr-1"}),e[61]||(e[61]=t("span",{class:"text-xs"},"Cek",-1))],8,On)]),t("div",Rn,[t("button",{onClick:W=>xt(n),class:"flex items-center justify-center text-red-600 hover:text-red-900 py-2 w-full"},[g(p(it),{class:"w-4 h-4 mr-1"}),e[62]||(e[62]=t("span",{class:"text-xs"},"Hapus",-1))],8,Gn)])])}),128))]),t("div",Nn,[t("table",Fn,[e[63]||(e[63]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Siswa "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Order ID "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Keterangan "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Jumlah "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Status "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Dibuat "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Aksi ")])],-1)),t("tbody",Vn,[(c(!0),m(L,null,I(Z.value,n=>{var u,_,h,S,G;return c(),m("tr",{key:n.id},[t("td",Jn,[t("div",qn,[t("div",zn,[t("span",Hn,i((h=(_=(u=n.student)==null?void 0:u.nickname)==null?void 0:_.charAt(0))==null?void 0:h.toUpperCase()),1)]),t("div",null,[t("div",Qn,i((S=n.student)==null?void 0:S.name),1),t("div",Yn,i((G=n.student)==null?void 0:G.nickname),1)])])]),t("td",Zn,i(n.order_id),1),t("td",Xn,i(n.description),1),t("td",tl,i(A(n.amount)),1),t("td",el,[t("span",{class:F(at(n.status))},i(st(n.status)),3)]),t("td",sl,i(X(n.created_at)),1),t("td",al,[t("div",nl,[t("button",{onClick:W=>lt(n),class:"text-primary-600 hover:text-primary-900",title:"Copy Link"},[g(p(kt),{class:"w-4 h-4"})],8,ll),t("button",{onClick:W=>ct(n),class:"text-success-600 hover:text-success-900",title:"Kirim via WhatsApp"},[g(p(z),{class:"w-4 h-4"})],8,ol),n.status==="pending"?(c(),m("button",{key:0,onClick:W=>bt(n),class:"text-green-600 hover:text-green-900",title:"Tandai Lunas"},[g(p(St),{class:"w-4 h-4"})],8,il)):C("",!0),t("button",{onClick:W=>yt(n),class:"text-purple-600 hover:text-purple-900",title:"Lihat Invoice"},[g(p(Ct),{class:"w-4 h-4"})],8,rl),t("button",{onClick:W=>gt(n),class:"text-warning-600 hover:text-warning-900",title:"Cek Status"},[g(p(Tt),{class:"w-4 h-4"})],8,dl),t("button",{onClick:W=>xt(n),class:"text-red-600 hover:text-red-900",title:"Hapus"},[g(p(it),{class:"w-4 h-4"})],8,ul)])])])}),128))])])]),Z.value.length===0?(c(),m("div",ml,e[64]||(e[64]=[t("p",{class:"text-sm text-gray-500"},"Tidak ada link pembayaran yang ditemukan",-1)]))):C("",!0)]),O.value?(c(),m("div",cl,[t("div",pl,[e[69]||(e[69]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Buat Link Pembayaran",-1)),t("form",{onSubmit:Lt(mt,["prevent"]),class:"space-y-4"},[t("div",null,[e[66]||(e[66]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Siswa",-1)),P(t("select",{"onUpdate:modelValue":e[13]||(e[13]=n=>T.studentId=n),required:"",class:"input-field"},[e[65]||(e[65]=t("option",{value:""},"Pilih Siswa",-1)),(c(!0),m(L,null,I(p(k).students,n=>(c(),m("option",{key:n.id,value:n.id},i(n.name)+" ("+i(n.nickname)+") ",9,gl))),128))],512),[[K,T.studentId]])]),t("div",null,[e[67]||(e[67]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Jumlah",-1)),P(t("input",{"onUpdate:modelValue":e[14]||(e[14]=n=>T.amount=n),type:"number",min:"1",required:"",class:"input-field",placeholder:"Masukkan jumlah"},null,512),[[Q,T.amount,void 0,{number:!0}]])]),t("div",null,[e[68]||(e[68]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Keterangan",-1)),P(t("input",{"onUpdate:modelValue":e[15]||(e[15]=n=>T.description=n),type:"text",required:"",class:"input-field",placeholder:"Contoh: Kas bulanan Februari"},null,512),[[Q,T.description]])]),t("div",bl,[t("button",{type:"button",onClick:e[16]||(e[16]=n=>O.value=!1),class:"btn-secondary"}," Batal "),t("button",{type:"submit",disabled:D.value,class:"btn-primary"},i(D.value?"Membuat...":"Buat Link"),9,xl)])],32)])])):C("",!0),y.value&&B.value?(c(),m("div",yl,[t("div",hl,[e[75]||(e[75]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Link Pembayaran",-1)),t("div",vl,[t("div",null,[e[70]||(e[70]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Siswa",-1)),t("p",fl,i((x=B.value.student)==null?void 0:x.name),1)]),t("div",null,[e[71]||(e[71]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Jumlah",-1)),t("p",kl,i(A(B.value.amount)),1)]),t("div",null,[e[72]||(e[72]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Order ID",-1)),t("p",_l,i(B.value.order_id),1)]),t("div",null,[e[73]||(e[73]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Link Pembayaran",-1)),t("div",wl,[t("input",{value:B.value.payment_url,readonly:"",class:"input-field text-xs"},null,8,$l),t("button",{onClick:e[17]||(e[17]=n=>ht(B.value.payment_url)),class:"btn-secondary p-2"},[g(p(ft),{class:"w-4 h-4"})])])])]),t("div",Pl,[t("button",{onClick:e[18]||(e[18]=n=>y.value=!1),class:"btn-secondary"}," Tutup "),t("button",{onClick:e[19]||(e[19]=n=>pt(B.value)),class:"btn-success"},[g(p(z),{class:"w-4 h-4 mr-2"}),e[74]||(e[74]=E(" Kirim via WhatsApp ",-1))])])])])):C("",!0),v.value?(c(),m("div",Cl,[t("div",Sl,[e[79]||(e[79]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Tidak Dapat Mengirim Pesan",-1)),t("div",Dl,[e[77]||(e[77]=t("div",{class:"bg-yellow-50 border border-yellow-200 rounded-lg p-3"},[t("p",{class:"text-sm text-yellow-800"},[t("strong",null,"CORS Error:"),E(" Browser memblokir API call langsung ke StarSender. Untuk production, implementasikan API calls melalui backend server. ")])],-1)),t("div",null,[t("label",Al,"Pesan untuk "+i(j.value.studentName)+":",1),t("textarea",{value:j.value.message,readonly:"",rows:"6",class:"input-field text-xs"},null,8,Ml)]),t("div",null,[e[76]||(e[76]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nomor WhatsApp:",-1)),t("div",Tl,[t("input",{value:j.value.phone,readonly:"",class:"input-field text-sm"},null,8,Ll),t("button",{onClick:e[20]||(e[20]=n=>ht(j.value.phone)),class:"btn-secondary p-2",title:"Copy nomor"},[g(p(ft),{class:"w-4 h-4"})])])]),e[78]||(e[78]=t("div",{class:"bg-blue-50 border border-blue-200 rounded-lg p-3"},[t("p",{class:"text-sm text-blue-800"},[t("strong",null,"Alternatif:"),E(" Copy pesan dan nomor di atas, lalu kirim manual melalui WhatsApp Web atau aplikasi WhatsApp. ")])],-1))]),t("div",Il,[t("button",{onClick:_t,class:"btn-primary flex-1"}," Copy Pesan & Nomor "),t("button",{onClick:ot,class:"btn-success flex-1"}," Buka WhatsApp Web "),t("button",{onClick:e[21]||(e[21]=n=>v.value=!1),class:"btn-secondary"}," Tutup ")])])])):C("",!0)])):R.value==="multi"?(c(),m("div",Bl,[g(ka)])):C("",!0)])}}};export{Jl as default};

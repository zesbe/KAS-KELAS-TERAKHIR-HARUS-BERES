import{b as D,u as $}from"./index-DyprfSbd.js";import{r as b,J as M,o as z,c as i,E as a,l as e,k as j,R as C,W as L,F as P,y as T,q as l,S as V,b as A,p as B,f as I,M as x}from"./vendor-Cn5j0SEu.js";import{p as y}from"./paymentNotificationService-DMPYb6UY.js";import"./excel-C9Ruqv6W.js";const E={class:"border rounded-lg p-4 bg-blue-50"},R={class:"space-y-3"},W=["value"],U={class:"flex space-x-2"},H=["disabled"],O=["disabled"],K={key:0,class:"mt-4 space-y-2"},F={class:"font-medium"},G={class:"mt-4 p-3 bg-white rounded border"},J={class:"text-xs font-mono bg-gray-100 p-2 rounded break-all"},q={__name:"PaymentNotificationTester",props:{students:{type:Array,default:()=>[]}},setup(h){const c=h;D();const n=$(),r=b(""),m=b(5e4),p=b(!1),v=b(!1),d=b([]),k=M(()=>`${window.location.origin}/webhook/payment`),w=async()=>{if(!r.value){n.error("Pilih siswa terlebih dahulu");return}try{p.value=!0;const o=await y.testPaymentNotification(r.value,parseInt(m.value));o.success&&(u(!0,`‚úÖ ${o.message}`),n.success("Test notification berhasil dikirim!"))}catch(o){console.error("Test notification error:",o),u(!1,`‚ùå Error: ${o.message}`),n.error("Gagal mengirim test notification")}finally{p.value=!1}},S=async()=>{if(!r.value){n.error("Pilih siswa terlebih dahulu");return}try{v.value=!0;const o=c.students.find(N=>N.id===r.value);if(!o)throw new Error("Student not found");const s=`TEST${Date.now()}${Math.random().toString(36).substr(2,6).toUpperCase()}`,t={id:`pl_test_${Date.now()}`,student_id:r.value,order_id:s,payment_url:`https://pakasir.zone.id/pay/test/${m.value}?order_id=${s}`,amount:parseInt(m.value),description:"Test Payment - Kas Kelas",status:"pending",campaign_id:"test_campaign",expires_at:new Date(Date.now()+7*24*60*60*1e3).toISOString()};await y.storePaymentLink(t),u(!0,`üí≥ Payment link created: ${s}`);const g={order_id:s,amount:parseInt(m.value),payment_method:"qris",status:"completed",completed_at:new Date().toISOString(),project:"uang-kas-kelas-1-ibnu-sina"},f=await y.processPaymentWebhook(g);f.success&&(u(!0,`üéâ Webhook processed successfully for ${f.student.name}`),u(!0,`üì± WhatsApp notification sent to ${o.phone}`),n.success("Simulasi webhook lengkap berhasil!"))}catch(o){console.error("Webhook simulation error:",o),u(!1,`‚ùå Webhook simulation error: ${o.message}`),n.error("Simulasi webhook gagal")}finally{v.value=!1}},u=(o,s)=>{d.value.unshift({id:Date.now(),success:o,message:s,timestamp:new Date().toLocaleTimeString("id-ID")}),d.value.length>10&&(d.value=d.value.slice(0,10))},_=async()=>{try{const o=await y.getPaymentStatistics();u(!0,`üìä Stats: ${o.completedPayments}/${o.totalLinks} payments (${o.conversionRate}%)`)}catch(o){u(!1,`‚ùå Failed to get stats: ${o.message}`)}};return z(()=>{u(!0,"üß™ Payment Notification Tester ready"),_()}),(o,s)=>(a(),i("div",E,[s[8]||(s[8]=e("h4",{class:"font-medium text-blue-900 mb-3"},"üß™ Test Payment Notification",-1)),e("div",R,[e("div",null,[s[3]||(s[3]=e("label",{class:"block text-sm font-medium text-gray-700"}," Pilih Siswa untuk Test ",-1)),C(e("select",{"onUpdate:modelValue":s[0]||(s[0]=t=>r.value=t),class:"input-field"},[s[2]||(s[2]=e("option",{value:""},"-- Pilih Siswa --",-1)),(a(!0),i(P,null,T(h.students,t=>(a(),i("option",{key:t.id,value:t.id},l(t.name)+" ("+l(t.nickname)+") - "+l(t.phone),9,W))),128))],512),[[L,r.value]])]),e("div",null,[s[4]||(s[4]=e("label",{class:"block text-sm font-medium text-gray-700"}," Jumlah Pembayaran Test ",-1)),C(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>m.value=t),type:"number",min:"1",class:"input-field",placeholder:"50000"},null,512),[[V,m.value]])]),e("div",U,[e("button",{onClick:w,disabled:!r.value||p.value,class:"btn-primary flex-1"},l(p.value?"Mengirim...":"üöÄ Test Notifikasi"),9,H),e("button",{onClick:S,disabled:!r.value||v.value,class:"btn-secondary flex-1"},l(v.value?"Simulasi...":"üì° Simulasi Webhook"),9,O)])]),d.value.length>0?(a(),i("div",K,[s[5]||(s[5]=e("h5",{class:"font-medium text-gray-900"},"üìã Test Results:",-1)),(a(!0),i(P,null,T(d.value,t=>(a(),i("div",{key:t.id,class:A(["text-sm p-2 rounded",t.success?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},[e("span",F,l(t.timestamp)+":",1),B(" "+l(t.message),1)],2))),128))])):j("",!0),e("div",G,[s[6]||(s[6]=e("h5",{class:"font-medium text-gray-900 mb-2"},"üì° Webhook URL untuk PakaSir:",-1)),e("div",J,l(k.value),1),s[7]||(s[7]=e("p",{class:"text-xs text-gray-600 mt-1"}," Gunakan URL ini sebagai webhook endpoint di dashboard PakaSir ",-1))])]))}},Q={class:"space-y-8"},X={class:"bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl p-6 text-white"},Y={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between"},Z={class:"mt-4 sm:mt-0 text-right"},ee={class:"bg-white/20 rounded-lg px-4 py-2 backdrop-blur-sm"},te={class:"text-xl font-bold"},se={class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},oe={class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},ae={class:"p-6"},ne=["disabled"],re={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},ie={key:1,class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},le={class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},de={class:"p-6"},ce={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ue={class:"space-y-4"},me={class:"space-y-3"},pe=["disabled"],ve={class:"flex items-center"},ge={key:0,class:"animate-spin w-5 h-5 text-indigo-600 mr-3",fill:"none",viewBox:"0 0 24 24"},be={key:1,class:"w-5 h-5 text-indigo-600 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},fe={class:"text-sm font-medium text-indigo-900"},xe=["disabled"],ye={class:"flex items-center"},he={key:0,class:"animate-spin w-5 h-5 text-orange-600 mr-3",fill:"none",viewBox:"0 0 24 24"},ke={key:1,class:"w-5 h-5 text-orange-600 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},we={class:"text-sm font-medium text-orange-900"},Se=["disabled"],_e={class:"flex items-center"},Ce={key:0,class:"animate-spin w-5 h-5 text-red-600 mr-3",fill:"none",viewBox:"0 0 24 24"},Pe={key:1,class:"w-5 h-5 text-red-600 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Te={class:"text-sm font-medium text-red-900"},Be={__name:"Settings",setup(h){const c=D(),n=$(),r=b(!1),m=b(!1),p=b(!1),v=b(!1),d=b(!1),k=M(()=>c.currentBalance||0),w=s=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(s),S=async()=>{r.value=!0;try{await new Promise(s=>setTimeout(s,1500)),m.value=!0,n.success("Payment notification tester opened!")}catch(s){n.error("Failed to open payment notification tester"),console.error("Error:",s)}finally{r.value=!1}},u=async()=>{p.value=!0;try{const s={students:c.students,transactions:c.transactions,expenses:c.expenses,paymentLinks:c.paymentLinks,exportDate:new Date().toISOString(),version:"1.0.0"},t=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),g=URL.createObjectURL(t),f=document.createElement("a");f.href=g,f.download=`kas-kelas-backup-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(g),n.success("‚úÖ Data berhasil diekspor!")}catch(s){n.error("‚ùå Gagal mengekspor data"),console.error("Export error:",s)}finally{p.value=!1}},_=async()=>{v.value=!0;try{await Promise.all([c.fetchStudents(),c.fetchTransactions(),c.fetchExpenses(),c.fetchPaymentLinks()]),n.success("üîÑ Data berhasil disinkronisasi!")}catch(s){n.error("‚ùå Gagal menyinkronkan data"),console.error("Sync error:",s)}finally{v.value=!1}},o=async()=>{d.value=!0;try{const s=["user_session","user_preferences"];Object.keys(localStorage).forEach(g=>{s.includes(g)||localStorage.removeItem(g)}),sessionStorage.clear(),await new Promise(g=>setTimeout(g,1e3)),n.success("üóëÔ∏è Cache berhasil dibersihkan!"),setTimeout(()=>{window.location.reload()},1500)}catch(s){n.error("‚ùå Gagal membersihkan cache"),console.error("Clear cache error:",s)}finally{d.value=!1}};return(s,t)=>(a(),i("div",Q,[e("div",X,[e("div",Y,[t[2]||(t[2]=e("div",null,[e("h1",{class:"text-2xl sm:text-3xl font-bold mb-2"},"‚öôÔ∏è Pengaturan"),e("p",{class:"text-blue-100"},"Kelola pengaturan sistem dan konfigurasi")],-1)),e("div",Z,[e("div",ee,[t[1]||(t[1]=e("span",{class:"text-sm text-blue-100"},"Saldo:",-1)),e("div",te,l(w(k.value)),1)])])])]),e("div",se,[e("div",oe,[t[7]||(t[7]=x('<div class="bg-gradient-to-r from-green-50 to-emerald-50 px-6 py-4 border-b border-gray-200"><div class="flex items-center"><div class="bg-green-100 rounded-lg p-2 mr-3"><svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg></div><div><h3 class="text-lg font-semibold text-gray-900">Payment Notification Testing</h3><p class="text-sm text-gray-600">Test sistem notifikasi pembayaran</p></div></div></div>',1)),e("div",ae,[t[5]||(t[5]=x('<div class="bg-blue-50 rounded-lg p-4 mb-4"><div class="flex items-start"><div class="bg-blue-100 rounded p-1 mr-3"><svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><div class="text-sm text-blue-800"><p class="font-medium">üí° Test Payment Notification</p><p class="mt-1">Gunakan untuk memastikan sistem notifikasi pembayaran berfungsi dengan baik</p></div></div></div>',1)),e("button",{onClick:S,disabled:r.value,class:"w-full bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white font-medium py-3 px-4 rounded-lg transition-all duration-200 transform hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"},[r.value?(a(),i("svg",re,t[3]||(t[3]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(a(),i("svg",ie,t[4]||(t[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)]))),B(" "+l(r.value?"Testing...":"Test Payment Notification"),1)],8,ne),t[6]||(t[6]=e("p",{class:"text-xs text-gray-500 mt-3 text-center"}," Pilih Siswa untuk Test ",-1))])]),t[8]||(t[8]=x('<div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"><div class="bg-gradient-to-r from-blue-50 to-indigo-50 px-6 py-4 border-b border-gray-200"><div class="flex items-center"><div class="bg-blue-100 rounded-lg p-2 mr-3"><svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg></div><div><h3 class="text-lg font-semibold text-gray-900">StarSender WhatsApp API</h3><p class="text-sm text-gray-600">Konfigurasi integrasi WhatsApp</p></div></div></div><div class="p-6"><div class="bg-yellow-50 rounded-lg p-4 border border-yellow-200"><div class="flex items-start"><div class="bg-yellow-100 rounded p-1 mr-3"><svg class="w-4 h-4 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path></svg></div><div class="text-sm text-yellow-800"><p class="font-medium">‚ö†Ô∏è Supabase Proxy: Not Deployed</p><p class="mt-1">WhatsApp integration coming soon</p></div></div></div><div class="mt-4 space-y-3"><div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg"><span class="text-sm font-medium text-gray-700">Status API</span><span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs font-medium rounded-full"> Pending Setup </span></div><div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg"><span class="text-sm font-medium text-gray-700">Proxy Status</span><span class="px-2 py-1 bg-red-100 text-red-800 text-xs font-medium rounded-full"> Not Deployed </span></div></div><button class="w-full mt-4 bg-gray-300 text-gray-500 font-medium py-3 px-4 rounded-lg cursor-not-allowed" disabled><svg class="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg> Configuration Coming Soon </button></div></div>',1))]),e("div",le,[t[20]||(t[20]=x('<div class="bg-gradient-to-r from-gray-50 to-slate-50 px-6 py-4 border-b border-gray-200"><div class="flex items-center"><div class="bg-gray-100 rounded-lg p-2 mr-3"><svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"></path></svg></div><div><h3 class="text-lg font-semibold text-gray-900">‚öôÔ∏è Konfigurasi Sistem</h3><p class="text-sm text-gray-600">Pengaturan umum sistem manajemen kas</p></div></div></div>',1)),e("div",de,[e("div",ce,[t[19]||(t[19]=x('<div class="space-y-4"><h4 class="font-medium text-gray-900 border-b border-gray-200 pb-2">üìä Informasi Sistem</h4><div class="space-y-3"><div class="flex justify-between items-center p-3 bg-blue-50 rounded-lg"><span class="text-sm font-medium text-blue-900">Versi Aplikasi</span><span class="text-sm text-blue-700 font-mono">v1.0.0</span></div><div class="flex justify-between items-center p-3 bg-green-50 rounded-lg"><span class="text-sm font-medium text-green-900">Status Database</span><span class="px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full"> ‚úÖ Connected </span></div><div class="flex justify-between items-center p-3 bg-purple-50 rounded-lg"><span class="text-sm font-medium text-purple-900">Environment</span><span class="text-sm text-purple-700 font-mono">Development</span></div></div></div>',1)),e("div",ue,[t[18]||(t[18]=e("h4",{class:"font-medium text-gray-900 border-b border-gray-200 pb-2"},"üöÄ Quick Actions",-1)),e("div",me,[e("button",{onClick:u,disabled:p.value,class:"w-full text-left p-3 bg-indigo-50 hover:bg-indigo-100 rounded-lg transition-colors duration-200 border border-indigo-200 disabled:opacity-50 disabled:cursor-not-allowed"},[e("div",ve,[p.value?(a(),i("svg",ge,t[9]||(t[9]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(a(),i("svg",be,t[10]||(t[10]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,-1)]))),e("div",null,[e("div",fe,l(p.value?"Exporting...":"Export Data"),1),t[11]||(t[11]=e("div",{class:"text-xs text-indigo-600"},"Backup semua data sistem",-1))])])],8,pe),e("button",{onClick:_,disabled:v.value,class:"w-full text-left p-3 bg-orange-50 hover:bg-orange-100 rounded-lg transition-colors duration-200 border border-orange-200 disabled:opacity-50 disabled:cursor-not-allowed"},[e("div",ye,[v.value?(a(),i("svg",he,t[12]||(t[12]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(a(),i("svg",ke,t[13]||(t[13]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)]))),e("div",null,[e("div",we,l(v.value?"Syncing...":"Sync Data"),1),t[14]||(t[14]=e("div",{class:"text-xs text-orange-600"},"Sinkronisasi dengan server",-1))])])],8,xe),e("button",{onClick:o,disabled:d.value,class:"w-full text-left p-3 bg-red-50 hover:bg-red-100 rounded-lg transition-colors duration-200 border border-red-200 disabled:opacity-50 disabled:cursor-not-allowed"},[e("div",_e,[d.value?(a(),i("svg",Ce,t[15]||(t[15]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(a(),i("svg",Pe,t[16]||(t[16]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"},null,-1)]))),e("div",null,[e("div",Te,l(d.value?"Clearing...":"Clear Cache"),1),t[17]||(t[17]=e("div",{class:"text-xs text-red-600"},"Bersihkan cache aplikasi",-1))])])],8,Se)])])])])]),m.value?(a(),I(q,{key:0,onClose:t[0]||(t[0]=g=>m.value=!1)})):j("",!0)]))}};export{Be as default};

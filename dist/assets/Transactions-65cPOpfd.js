import{r as S,Q as $,J as P,c as o,E as d,l as t,k as C,H as c,z as m,q as i,R as u,W as f,F as b,y as _,S as k,b as E,x as H}from"./vendor-Cn5j0SEu.js";import{b as J,u as N,e as z,h as R}from"./index-GcpNd-v9.js";import{r as G}from"./PlusIcon-Hols0ICP.js";import{r as Q}from"./ClockIcon-A7fuk63B.js";import{r as L,a as O}from"./TrashIcon-8_Rw6v_G.js";import{f as W,l as X}from"./index-BoRhMNJp.js";import"./excel-C9Ruqv6W.js";const Y={class:"space-y-6"},Z={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0"},tt={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6"},st={class:"card p-4 sm:p-6"},et={class:"flex items-center"},at={class:"p-2 bg-success-100 rounded-lg"},nt={class:"ml-4"},it={class:"text-2xl font-semibold text-gray-900"},lt={class:"card p-4 sm:p-6"},ot={class:"flex items-center"},dt={class:"p-2 bg-warning-100 rounded-lg"},rt={class:"ml-4"},mt={class:"text-2xl font-semibold text-gray-900"},ut={class:"card p-4 sm:p-6"},pt={class:"flex items-center"},ct={class:"p-2 bg-primary-100 rounded-lg"},xt={class:"ml-4"},yt={class:"text-2xl font-semibold text-gray-900"},ft={class:"card p-4 sm:p-6"},gt={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"},vt=["value"],bt={class:"card p-4 sm:p-6"},_t={class:"block sm:hidden space-y-4"},kt={class:"flex items-center justify-between mb-2"},wt={class:"flex items-center"},ht={class:"w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center mr-3"},Tt={class:"text-primary-600 font-semibold text-xs"},St={class:"font-medium text-sm"},Ct={class:"text-gray-500 text-xs"},Dt={class:"space-y-1 text-sm"},Ft={class:"flex justify-between"},Mt={class:"text-right"},Vt={class:"flex justify-between"},jt={class:"text-success-600 font-medium"},It={key:0,class:"flex justify-between"},Ut={class:"text-xs"},$t={class:"flex justify-between"},Pt={class:"text-xs"},Et={class:"flex items-center justify-center space-x-3 mt-3 pt-3 border-t border-gray-200"},Kt=["onClick"],Bt=["onClick"],At={class:"hidden sm:block overflow-x-auto"},qt={class:"min-w-full divide-y divide-gray-200"},Ht={class:"bg-white divide-y divide-gray-200"},Jt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Nt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},zt={class:"px-6 py-4 text-sm text-gray-500"},Rt={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-success-600"},Gt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Qt={class:"px-6 py-4 whitespace-nowrap"},Lt={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},Ot={class:"flex items-center space-x-2"},Wt=["onClick"],Xt=["onClick"],Yt={key:0,class:"text-center py-8"},Zt={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},ts={class:"bg-white rounded-lg max-w-md w-full mx-4 p-4 sm:p-6"},ss={class:"text-lg font-semibold text-gray-900 mb-4"},es=["value"],as={class:"flex justify-end space-x-3 pt-4"},ns=["disabled"],cs={__name:"Transactions",setup(is){const r=J(),x=N(),w=S(!1),p=S(null),g=S(!1),l=$({status:"",studentId:"",dateFrom:"",dateTo:""}),n=$({student_id:"",amount:0,description:"",payment_method:"cash",status:"completed"}),K=P(()=>r.transactions.filter(a=>a.status==="pending")),h=P(()=>{let a=r.transactions.filter(s=>s.type==="income");return l.status&&(a=a.filter(s=>s.status===l.status)),l.studentId&&(a=a.filter(s=>s.student_id===l.studentId)),l.dateFrom&&(a=a.filter(s=>new Date(s.created_at)>=new Date(l.dateFrom))),l.dateTo&&(a=a.filter(s=>new Date(s.created_at)<=new Date(l.dateTo+"T23:59:59"))),a}),T=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),D=a=>W(new Date(a),"dd MMM yyyy HH:mm",{locale:X}),F=a=>{p.value=a,n.student_id=a.student_id,n.amount=a.amount,n.description=a.description,n.payment_method=a.payment_method||"cash",n.status=a.status},M=()=>{w.value=!1,p.value=null,B()},B=()=>{n.student_id="",n.amount=0,n.description="",n.payment_method="cash",n.status="completed"},A=async()=>{try{g.value=!0;const a={type:"income",student_id:n.student_id,amount:n.amount,description:n.description,payment_method:n.payment_method,status:n.status,created_at:new Date().toISOString()};p.value?(await r.db.updateTransaction(p.value.id,a),x.success("Transaksi berhasil diupdate")):(await r.addTransaction(a),x.success("Transaksi baru berhasil ditambahkan")),M()}catch(a){x.error("Gagal menyimpan transaksi"),console.error("Error saving transaction:",a)}finally{g.value=!1}},V=async a=>{if(confirm("Apakah Anda yakin ingin menghapus transaksi ini?"))try{await r.db.deleteTransaction(a.id),await r.fetchTransactions(),x.success("Transaksi berhasil dihapus")}catch(s){x.error("Gagal menghapus transaksi"),console.error("Error deleting transaction:",s)}};return(a,s)=>(d(),o("div",Y,[t("div",Z,[s[12]||(s[12]=t("div",null,[t("h1",{class:"text-xl sm:text-2xl font-semibold text-gray-900"},"Transaksi Kas"),t("p",{class:"text-sm text-gray-500 mt-1"},"Kelola semua transaksi pemasukan kas kelas")],-1)),t("button",{onClick:s[0]||(s[0]=e=>w.value=!0),class:"btn-primary w-full sm:w-auto"},[c(m(G),{class:"w-4 h-4 mr-2"}),s[10]||(s[10]=t("span",{class:"hidden sm:inline"},"Tambah Transaksi",-1)),s[11]||(s[11]=t("span",{class:"sm:hidden"},"Tambah",-1))])]),t("div",tt,[t("div",st,[t("div",et,[t("div",at,[c(m(z),{class:"w-6 h-6 text-success-600"})]),t("div",nt,[s[13]||(s[13]=t("p",{class:"text-sm font-medium text-gray-600"},"Total Pemasukan",-1)),t("p",it,i(T(m(r).totalIncome)),1)])])]),t("div",lt,[t("div",ot,[t("div",dt,[c(m(Q),{class:"w-6 h-6 text-warning-600"})]),t("div",rt,[s[14]||(s[14]=t("p",{class:"text-sm font-medium text-gray-600"},"Transaksi Pending",-1)),t("p",mt,i(K.value.length),1)])])]),t("div",ut,[t("div",pt,[t("div",ct,[c(m(R),{class:"w-6 h-6 text-primary-600"})]),t("div",xt,[s[15]||(s[15]=t("p",{class:"text-sm font-medium text-gray-600"},"Siswa Sudah Bayar",-1)),t("p",yt,i(m(r).studentsByPaymentStatus.paid.length),1)])])])]),t("div",ft,[t("div",gt,[t("div",null,[s[17]||(s[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Filter Status",-1)),u(t("select",{"onUpdate:modelValue":s[1]||(s[1]=e=>l.status=e),class:"input-field"},s[16]||(s[16]=[t("option",{value:""},"Semua Status",-1),t("option",{value:"completed"},"Selesai",-1),t("option",{value:"pending"},"Pending",-1)]),512),[[f,l.status]])]),t("div",null,[s[19]||(s[19]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Filter Siswa",-1)),u(t("select",{"onUpdate:modelValue":s[2]||(s[2]=e=>l.studentId=e),class:"input-field"},[s[18]||(s[18]=t("option",{value:""},"Semua Siswa",-1)),(d(!0),o(b,null,_(m(r).students,e=>(d(),o("option",{key:e.id,value:e.id},i(e.name),9,vt))),128))],512),[[f,l.studentId]])]),t("div",null,[s[20]||(s[20]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Dari Tanggal",-1)),u(t("input",{"onUpdate:modelValue":s[3]||(s[3]=e=>l.dateFrom=e),type:"date",class:"input-field"},null,512),[[k,l.dateFrom]])]),t("div",null,[s[21]||(s[21]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Sampai Tanggal",-1)),u(t("input",{"onUpdate:modelValue":s[4]||(s[4]=e=>l.dateTo=e),type:"date",class:"input-field"},null,512),[[k,l.dateTo]])])])]),t("div",bt,[t("div",_t,[(d(!0),o(b,null,_(h.value,e=>{var y,v,j,I,U;return d(),o("div",{key:e.id,class:"bg-gray-50 rounded-lg p-4"},[t("div",kt,[t("div",wt,[t("div",ht,[t("span",Tt,i(((j=(v=(y=e.student)==null?void 0:y.nickname)==null?void 0:v.charAt(0))==null?void 0:j.toUpperCase())||"K"),1)]),t("div",null,[t("div",St,i(((I=e.student)==null?void 0:I.name)||"Kas Umum"),1),t("div",Ct,i(((U=e.student)==null?void 0:U.nickname)||""),1)])]),t("span",{class:E(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",e.status==="completed"?"bg-success-100 text-success-800":"bg-warning-100 text-warning-800"])},i(e.status==="completed"?"Selesai":"Pending"),3)]),t("div",Dt,[t("div",Ft,[s[22]||(s[22]=t("span",{class:"text-gray-600"},"Keterangan:",-1)),t("span",Mt,i(e.description),1)]),t("div",Vt,[s[23]||(s[23]=t("span",{class:"text-gray-600"},"Jumlah:",-1)),t("span",jt," +"+i(T(e.amount)),1)]),e.payment_method?(d(),o("div",It,[s[24]||(s[24]=t("span",{class:"text-gray-600"},"Metode:",-1)),t("span",Ut,i(e.payment_method||"Manual"),1)])):C("",!0),t("div",$t,[s[25]||(s[25]=t("span",{class:"text-gray-600"},"Tanggal:",-1)),t("span",Pt,i(D(e.created_at)),1)])]),t("div",Et,[t("button",{onClick:q=>F(e),class:"flex items-center text-primary-600 hover:text-primary-900"},[c(m(L),{class:"w-4 h-4 mr-1"}),s[26]||(s[26]=t("span",{class:"text-xs"},"Edit",-1))],8,Kt),t("button",{onClick:q=>V(e),class:"flex items-center text-red-600 hover:text-red-900"},[c(m(O),{class:"w-4 h-4 mr-1"}),s[27]||(s[27]=t("span",{class:"text-xs"},"Hapus",-1))],8,Bt)])])}),128))]),t("div",At,[t("table",qt,[s[28]||(s[28]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Tanggal "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Siswa "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Keterangan "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Jumlah "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Metode "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Status "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Aksi ")])],-1)),t("tbody",Ht,[(d(!0),o(b,null,_(h.value,e=>{var y;return d(),o("tr",{key:e.id},[t("td",Jt,i(D(e.created_at)),1),t("td",Nt,i(((y=e.student)==null?void 0:y.name)||"-"),1),t("td",zt,i(e.description),1),t("td",Rt,i(T(e.amount)),1),t("td",Gt,i(e.payment_method||"Manual"),1),t("td",Qt,[t("span",{class:E(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",e.status==="completed"?"bg-success-100 text-success-800":"bg-warning-100 text-warning-800"])},i(e.status==="completed"?"Selesai":"Pending"),3)]),t("td",Lt,[t("div",Ot,[t("button",{onClick:v=>F(e),class:"text-primary-600 hover:text-primary-900"}," Edit ",8,Wt),t("button",{onClick:v=>V(e),class:"text-red-600 hover:text-red-900"}," Hapus ",8,Xt)])])])}),128))])])]),h.value.length===0?(d(),o("div",Yt,s[29]||(s[29]=[t("p",{class:"text-sm text-gray-500"},"Tidak ada transaksi yang ditemukan",-1)]))):C("",!0)]),w.value||p.value?(d(),o("div",Zt,[t("div",ts,[t("h3",ss,i(p.value?"Edit Transaksi":"Tambah Transaksi Baru"),1),t("form",{onSubmit:H(A,["prevent"]),class:"space-y-4"},[t("div",null,[s[31]||(s[31]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Siswa",-1)),u(t("select",{"onUpdate:modelValue":s[5]||(s[5]=e=>n.student_id=e),required:"",class:"input-field"},[s[30]||(s[30]=t("option",{value:""},"Pilih Siswa",-1)),(d(!0),o(b,null,_(m(r).students,e=>(d(),o("option",{key:e.id,value:e.id},i(e.name)+" ("+i(e.nickname)+") ",9,es))),128))],512),[[f,n.student_id]])]),t("div",null,[s[32]||(s[32]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Jumlah",-1)),u(t("input",{"onUpdate:modelValue":s[6]||(s[6]=e=>n.amount=e),type:"number",min:"1",required:"",class:"input-field",placeholder:"Masukkan jumlah"},null,512),[[k,n.amount,void 0,{number:!0}]])]),t("div",null,[s[33]||(s[33]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Keterangan",-1)),u(t("input",{"onUpdate:modelValue":s[7]||(s[7]=e=>n.description=e),type:"text",required:"",class:"input-field",placeholder:"Contoh: Kas bulanan Januari"},null,512),[[k,n.description]])]),t("div",null,[s[35]||(s[35]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Metode Pembayaran",-1)),u(t("select",{"onUpdate:modelValue":s[8]||(s[8]=e=>n.payment_method=e),class:"input-field"},s[34]||(s[34]=[t("option",{value:"cash"},"Tunai",-1),t("option",{value:"qris"},"QRIS",-1),t("option",{value:"transfer"},"Transfer",-1)]),512),[[f,n.payment_method]])]),t("div",null,[s[37]||(s[37]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Status",-1)),u(t("select",{"onUpdate:modelValue":s[9]||(s[9]=e=>n.status=e),class:"input-field"},s[36]||(s[36]=[t("option",{value:"completed"},"Selesai",-1),t("option",{value:"pending"},"Pending",-1)]),512),[[f,n.status]])]),t("div",as,[t("button",{type:"button",onClick:M,class:"btn-secondary"}," Batal "),t("button",{type:"submit",disabled:g.value,class:"btn-primary"},i(g.value?"Menyimpan...":"Simpan"),9,ns)])],32)])])):C("",!0)]))}};export{cs as default};

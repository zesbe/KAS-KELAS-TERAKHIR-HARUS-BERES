import{X as p}from"./excel-C9Ruqv6W.js";import{f as w,l as _}from"./index-BoRhMNJp.js";let d=p;typeof window<"u"&&(window.XLSX||(window.XLSX=p),d=window.XLSX||p);class f{constructor(){this.className="Kelas 1B SD Islam Al Husna",this.academicYear="2025/2026"}formatCurrency(a){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(a)}formatDate(a){return w(new Date(a),"dd/MM/yyyy HH:mm",{locale:_})}downloadCSV(a,i,o){const s=[a.join(","),...i.map(e=>e.map(t=>`"${((t==null?void 0:t.toString())||"").replace(/"/g,'""')}"`).join(","))].join(`
`),r=new Blob([s],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a");n.href=URL.createObjectURL(r),n.download=`${o}.csv`,n.click()}downloadJSON(a,i){const o=new Blob([a],{type:"application/json"}),s=document.createElement("a");s.href=URL.createObjectURL(o),s.download=`${i}.json`,s.click()}downloadExcel(a,i){const o=d.utils.book_new();a.forEach(({name:s,data:r,headers:n})=>{let e=[];n&&e.push(n),e=e.concat(r);const t=d.utils.aoa_to_sheet(e),c=d.utils.decode_range(t["!ref"]),m=[];for(let l=c.s.c;l<=c.e.c;++l){let u=10;for(let g=c.s.r;g<=c.e.r;++g){const y=d.utils.encode_cell({r:g,c:l}),h=t[y];if(h&&h.v){const S=h.v.toString().length;S>u&&(u=Math.min(S,50))}}m.push({width:u})}t["!cols"]=m,d.utils.book_append_sheet(o,t,s)}),d.writeFile(o,`${i}.xlsx`)}exportStudents(a){const i=["No","Nama Lengkap","Nama Panggilan","No. HP Orang Tua","Tanggal Input"],o=a.map((r,n)=>[n+1,r.name,r.nickname,r.phone,this.formatDate(r.created_at||new Date().toISOString())]),s=new Date().toISOString().slice(0,10);this.downloadCSV(i,o,`data_siswa_${this.className.replace(/\s+/g,"_")}_${s}`)}exportTransactions(a,i){const o=["Tanggal","Nama Siswa","Nama Panggilan","Keterangan","Jumlah (IDR)","Status","Metode Pembayaran","Order ID"],s=a.map(n=>{const e=i.find(t=>t.id===n.student_id);return[this.formatDate(n.created_at),(e==null?void 0:e.name)||"",(e==null?void 0:e.nickname)||"",n.description,n.amount,n.status==="completed"?"Selesai":"Pending",n.payment_method||"Manual",n.order_id||""]}),r=new Date().toISOString().slice(0,10);this.downloadCSV(o,s,`transaksi_kas_${r}`)}exportExpenses(a){const i=["Tanggal","Kategori","Keterangan","Catatan","Jumlah (IDR)","Status","Disetujui Oleh","Tanggal Disetujui"],o={kegiatan:"Kegiatan Kelas",perlengkapan:"Perlengkapan",konsumsi:"Konsumsi",transport:"Transport",lainnya:"Lainnya"},s={pending:"Menunggu Persetujuan",approved:"Disetujui",rejected:"Ditolak"},r=a.map(e=>[this.formatDate(e.created_at),o[e.category]||e.category,e.description,e.notes||"",e.amount,s[e.status]||e.status,e.approved_by||"",e.approved_at?this.formatDate(e.approved_at):""]),n=new Date().toISOString().slice(0,10);this.downloadCSV(i,r,`pengeluaran_kas_${n}`)}exportComprehensiveReport(a,i){const o=["Kategori","Keterangan","Nilai","Unit","Persentase"],s=a.paidStudents.length+a.unpaidStudents.length,r=s>0?Math.round(a.paidStudents.length/s*100):0,n=[["=== INFORMASI UMUM ===","","","",""],["Kelas",this.className,"","",""],["Tahun Ajaran",this.academicYear,"","",""],["Periode Laporan",i.from+" s/d "+i.to,"","",""],["Tanggal Export",this.formatDate(new Date().toISOString()),"","",""],["","","","",""],["=== RINGKASAN KEUANGAN ===","","","",""],["Total Pemasukan",this.formatCurrency(a.totalIncome),a.totalIncome,"IDR","100%"],["Total Pengeluaran",this.formatCurrency(a.totalExpenses),a.totalExpenses,"IDR",Math.round(a.totalExpenses/a.totalIncome*100)+"%"],["Saldo Akhir",this.formatCurrency(a.balance),a.balance,"IDR",a.balance>=0?"Surplus":"Defisit"],["","","","",""],["=== STATUS PEMBAYARAN ===","","","",""],["Total Siswa",s,s,"Orang","100%"],["Siswa Sudah Bayar",a.paidStudents.length,a.paidStudents.length,"Orang",r+"%"],["Siswa Belum Bayar",a.unpaidStudents.length,a.unpaidStudents.length,"Orang",100-r+"%"],["","","","",""],["=== DETAIL SISWA SUDAH BAYAR ===","","","",""],["Nama","Total Dibayar","Status","",""],...a.paidStudents.map(t=>[t.name+" ("+t.nickname+")",this.formatCurrency(t.totalPaid),"Lunas",t.phone,""]),["","","","",""],["=== DETAIL SISWA BELUM BAYAR ===","","","",""],["Nama","Status","No. HP Orang Tua","",""],...a.unpaidStudents.map(t=>[t.name+" ("+t.nickname+")","Belum Bayar",t.phone,"",""])],e=new Date().toISOString().slice(0,10);this.downloadCSV(o,n,`laporan_lengkap_kas_${this.className.replace(/\s+/g,"_")}_${e}`)}exportPaymentStatus(a,i){const o=["No","Nama Siswa","Nama Panggilan","No. HP Orang Tua","Status Pembayaran","Total Dibayar","Tanggal Terakhir Bayar"],s=a.map((n,e)=>{const t=i.filter(l=>l.student_id===n.id&&l.type==="income"&&l.status==="completed"),c=t.reduce((l,u)=>l+u.amount,0),m=t.length>0?Math.max(...t.map(l=>new Date(l.created_at))):null;return[e+1,n.name,n.nickname,n.phone,c>0?"Sudah Bayar":"Belum Bayar",c>0?this.formatCurrency(c):"-",m?this.formatDate(m):"-"]}),r=new Date().toISOString().slice(0,10);this.downloadCSV(o,s,`status_pembayaran_${r}`)}exportExpensesByCategory(a){const i={kegiatan:"Kegiatan Kelas",perlengkapan:"Perlengkapan",konsumsi:"Konsumsi",transport:"Transport",lainnya:"Lainnya"},o={},s={};a.filter(t=>t.status==="approved").forEach(t=>{const c=t.category;o[c]||(o[c]=0,s[c]=[]),o[c]+=t.amount,s[c].push(t)});const r=["Kategori","Keterangan","Tanggal","Jumlah (IDR)","Disetujui Oleh"],n=[];Object.entries(o).forEach(([t,c])=>{n.push([i[t]||t,`=== TOTAL: ${this.formatCurrency(c)} ===`,"","",""]),s[t].forEach(m=>{n.push(["",m.description,this.formatDate(m.created_at),this.formatCurrency(m.amount),m.approved_by||""])}),n.push(["","","","",""])});const e=new Date().toISOString().slice(0,10);this.downloadCSV(r,n,`pengeluaran_per_kategori_${e}`)}createBackup(a){const i={metadata:{class:this.className,academic_year:this.academicYear,exported_at:new Date().toISOString(),version:"1.0.0",total_students:a.students.length,total_transactions:a.transactions.length,total_expenses:a.expenses.length,current_balance:a.currentBalance||0},data:a},o=JSON.stringify(i,null,2),s=new Date().toISOString().slice(0,10);this.downloadJSON(o,`backup_kas_${this.className.replace(/\s+/g,"_")}_${s}`)}}const N=new f;export{N as e};
